---
phase: 91-vertical-node-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/components/DAG/TaskNode.tsx
  - src/renderer/src/components/DAG/TaskNode.css
  - src/renderer/src/components/DAG/SelectableEdge.tsx
  - src/renderer/src/components/DAG/SelectableEdge.css
autonomous: true

must_haves:
  truths:
    - "Task nodes have connection handles on top and bottom only (no left/right handles)"
    - "Edges display downward-pointing arrow indicators"
    - "Vertical flow direction is visually clear from node handles and edge arrows"
  artifacts:
    - path: "src/renderer/src/components/DAG/TaskNode.tsx"
      provides: "Task node component with vertical handles"
      min_lines: 150
      contains: "Position.Top"
    - path: "src/renderer/src/components/DAG/SelectableEdge.tsx"
      provides: "Edge component with arrow indicators"
      min_lines: 140
  key_links:
    - from: "TaskNode.tsx"
      to: "@xyflow/react"
      via: "Position.Top and Position.Bottom"
      pattern: "Position\\.(Top|Bottom)"
    - from: "SelectableEdge.tsx"
      to: "arrow marker"
      via: "markerEnd prop rendering"
      pattern: "markerEnd"
---

<objective>
Update TaskNode and SelectableEdge components for vertical (top-to-bottom) DAG flow with top/bottom connection handles and downward arrow indicators.

Purpose: Enable clear vertical dependency visualization where tasks flow from top (no dependencies) to bottom (dependent tasks), with arrow indicators reinforcing downward flow direction.

Output: Modified TaskNode with top/bottom handles, SelectableEdge with arrow indicators, CSS updates for vertical styling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v2.8-ROADMAP.md
@.planning/STATE.md

# Prior phase context
@.planning/phases/89-integration-cleanup/89-01-SUMMARY.md
@.planning/phases/90-dag-api-core/90-01-SUMMARY.md

# Codebase context
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md

# Current implementation
@src/renderer/src/components/DAG/TaskNode.tsx
@src/renderer/src/components/DAG/SelectableEdge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update TaskNode handles for vertical flow</name>
  <files>src/renderer/src/components/DAG/TaskNode.tsx, src/renderer/src/components/DAG/TaskNode.css</files>
  <action>
Modify TaskNode component to use top/bottom handles instead of left/right:

**TaskNode.tsx changes:**
1. Replace left target handle (line 40):
   - Change `Position.Left` to `Position.Top`
   - Update comment from "Target handle (left)" to "Target handle (top)"

2. Replace right source handle (line 150):
   - Change `Position.Right` to `Position.Bottom`
   - Update comment from "Source handle (right)" to "Source handle (bottom)"

**TaskNode.css changes:**
1. Add/update handle positioning for vertical layout:
   ```css
   .task-node__handle {
     /* Existing styles remain */
   }

   /* Top handle - incoming dependencies */
   .task-node__handle[data-handlepos="top"] {
     top: -6px;
     left: 50%;
     transform: translateX(-50%);
   }

   /* Bottom handle - outgoing to dependents */
   .task-node__handle[data-handlepos="bottom"] {
     bottom: -6px;
     left: 50%;
     transform: translateX(-50%);
   }
   ```

2. Ensure node dimensions support vertical flow (if needed)

**Why top/bottom:**
- Top handle receives incoming edges from tasks we depend on (blockers above us)
- Bottom handle sends outgoing edges to tasks that depend on us (dependents below us)
- Reinforces top-to-bottom dependency flow visualization
  </action>
  <verify>
    - Run `npm run typecheck:web` - no TypeScript errors
    - Run `npm run build` - build succeeds
    - Grep for `Position.Left` and `Position.Right` in TaskNode.tsx returns no matches
    - Grep confirms `Position.Top` and `Position.Bottom` present in TaskNode.tsx
  </verify>
  <done>
    - TaskNode.tsx uses Position.Top for target handle and Position.Bottom for source handle
    - TaskNode.css has handle positioning for top and bottom positions
    - No left/right handles remain in TaskNode component
    - Build succeeds with no type errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add arrow indicators to SelectableEdge</name>
  <files>src/renderer/src/components/DAG/SelectableEdge.tsx, src/renderer/src/components/DAG/SelectableEdge.css</files>
  <action>
Update SelectableEdge to display arrow indicators pointing downward:

**SelectableEdge.tsx changes:**
1. Ensure `markerEnd` prop is used in BaseEdge (already present at line 87)
   - Verify markerEnd is passed through correctly
   - No changes needed if already rendering

2. If arrow is not visible, ensure React Flow's default arrow marker is enabled:
   - Check if DAGView.tsx needs to define edge markers in ReactFlow component
   - Default `markerEnd="url(#arrow)"` should work with React Flow's built-in arrow SVG

**SelectableEdge.css changes (if styling needed):**
1. Add arrow marker styling to ensure visibility:
   ```css
   /* Arrow markers inherit edge stroke color */
   .react-flow__edge path.react-flow__edge-path {
     stroke: var(--text-muted);
   }

   .react-flow__edge[data-selected="true"] path.react-flow__edge-path {
     stroke: var(--accent-primary);
   }
   ```

2. Arrow marker should point downward (from source at top to target at bottom)
   - React Flow handles orientation automatically based on handle positions
   - No manual rotation needed

**Why arrow indicators:**
- Clearly shows dependency direction (task A blocks task B â†’ arrow points from A to B downward)
- Eliminates ambiguity in graph reading
- Reinforces vertical top-to-bottom flow convention

**Note:** React Flow provides default arrow markers via SVG defs. If arrows don't appear, we may need to explicitly define markerEnd in edge data or ReactFlow props.
  </action>
  <verify>
    - Run `npm run typecheck:web` - no TypeScript errors
    - Run `npm run build` - build succeeds
    - Edge component still uses markerEnd prop (grep confirms)
    - No console errors about missing marker definitions
  </verify>
  <done>
    - SelectableEdge renders with arrow indicators at edge endpoints
    - Arrows point downward (from source handle to target handle)
    - Arrow color matches edge color (default gray, cyan when selected)
    - Build succeeds with no errors
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck:web` passes with no errors
- [ ] `npm run build` succeeds
- [ ] TaskNode uses Position.Top and Position.Bottom (not Left/Right)
- [ ] No remaining Position.Left or Position.Right in TaskNode.tsx
- [ ] SelectableEdge still uses markerEnd prop
- [ ] CSS has handle positioning for top/bottom handles
</verification>

<success_criteria>

- All tasks completed
- TaskNode component uses top/bottom handles only
- SelectableEdge component renders with arrow indicators
- No TypeScript errors or build failures
- Vertical flow direction is clear from handle placement
- Ready for Phase 92 (DAG View Integration with auto-placement)
  </success_criteria>

<output>
After completion, create `.planning/phases/91-vertical-node-ui/91-01-SUMMARY.md`
</output>
