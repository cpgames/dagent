---
phase: 87-shooting-stars-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/components/Background/layers/ShootingStarsLayer.ts
  - src/renderer/src/components/Background/layers/index.ts
autonomous: true

must_haves:
  truths:
    - "Shooting stars spawn randomly at approximately 1% chance per frame"
    - "Maximum 3 shooting stars visible at any time"
    - "Each shooting star has a gradient trail 35-50px in length"
    - "Stars move diagonally across the upper portion of the viewport"
  artifacts:
    - path: "src/renderer/src/components/Background/layers/ShootingStarsLayer.ts"
      provides: "Shooting star rendering with trails and spawn logic"
      min_lines: 60
      exports: ["ShootingStarsLayer"]
    - path: "src/renderer/src/components/Background/layers/index.ts"
      provides: "Barrel export including ShootingStarsLayer"
      contains: "ShootingStarsLayer"
  key_links:
    - from: "src/renderer/src/components/Background/layers/ShootingStarsLayer.ts"
      to: "Layer interface"
      via: "implements Layer"
      pattern: "implements Layer"
---

<objective>
Create ShootingStarsLayer class that renders animated shooting stars with gradient trails.

Purpose: Adds dynamic visual interest with rare, eye-catching shooting stars that streak across the synthwave sky.
Output: ShootingStarsLayer.ts implementing Layer interface, exported from barrel.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior layer implementation pattern:
@.planning/phases/86-grid-layer-integration/86-01-SUMMARY.md

# Layer interface and existing implementations:
@src/renderer/src/components/Background/layers/types.ts
@src/renderer/src/components/Background/layers/StarsLayer.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ShootingStarsLayer class</name>
  <files>src/renderer/src/components/Background/layers/ShootingStarsLayer.ts</files>
  <action>
Create a new ShootingStarsLayer class that implements the Layer interface.

**Internal ShootingStar interface:**
```typescript
interface ShootingStar {
  x: number;           // Current x position (pixels)
  y: number;           // Current y position (pixels)
  vx: number;          // Velocity x (pixels per ms, negative for left movement)
  vy: number;          // Velocity y (pixels per ms, positive for downward)
  trailLength: number; // Trail length 35-50px
  opacity: number;     // Current opacity (fades out near end)
  life: number;        // Remaining lifetime in ms
  maxLife: number;     // Initial lifetime for opacity calculation
}
```

**Class structure:**
- `private stars: ShootingStar[] = []` - Active shooting stars (max 3)
- `private readonly MAX_STARS = 3`
- `private readonly SPAWN_CHANCE = 0.01` - 1% per frame

**init():** No initialization needed (stars created dynamically)

**update(deltaTime):**
1. Spawn logic: If stars.length < MAX_STARS and Math.random() < SPAWN_CHANCE:
   - Spawn at x: random across width, y: random 0 to 20% of height
   - Velocity: vx = -0.3 to -0.5 px/ms (leftward), vy = 0.15 to 0.25 px/ms (downward)
   - Trail: 35 + Math.random() * 15 (35-50px)
   - Life: 2000-3000ms
2. Update each star:
   - Move by velocity * deltaTime
   - Decrease life by deltaTime
   - Calculate opacity based on remaining life (fade out in last 500ms)
3. Remove stars with life <= 0 or off-screen (x < -50 or y > height + 50)

**render(ctx, context):**
For each star:
1. Calculate trail end position: (x + trailLength * cos(angle), y - trailLength * sin(angle))
   - Angle derived from velocity: Math.atan2(-vy, -vx)
2. Create linear gradient from head (bright) to tail (transparent)
   - Head color: white with star.opacity
   - Tail color: white with 0 opacity
3. Draw line from tail to head with lineWidth 2
4. Draw small bright circle at head (radius 2, full opacity)

**reset():** Clear stars array

**Key constraints:**
- Do NOT use object pooling in this phase (PERF-01 is Phase 89)
- Use simple array push/filter for star management
- Stars should feel rare and special (1% spawn rate means ~1 every 100 frames)
  </action>
  <verify>npm run build -- passes with no TypeScript errors</verify>
  <done>ShootingStarsLayer class created with spawn logic, diagonal movement, gradient trails, and max 3 concurrent limit</done>
</task>

<task type="auto">
  <name>Task 2: Export ShootingStarsLayer from barrel</name>
  <files>src/renderer/src/components/Background/layers/index.ts</files>
  <action>
Add export for ShootingStarsLayer to the barrel file.

Current exports (alphabetical order):
```typescript
export { GridLayer } from './GridLayer';
export { HorizonGlowLayer } from './HorizonGlowLayer';
export { SkyLayer } from './SkyLayer';
export { StarsLayer } from './StarsLayer';
export type { Layer, LayerContext } from './types';
```

Add ShootingStarsLayer export in alphabetical position (after SkyLayer, before StarsLayer):
```typescript
export { GridLayer } from './GridLayer';
export { HorizonGlowLayer } from './HorizonGlowLayer';
export { ShootingStarsLayer } from './ShootingStarsLayer';
export { SkyLayer } from './SkyLayer';
export { StarsLayer } from './StarsLayer';
export type { Layer, LayerContext } from './types';
```
  </action>
  <verify>npm run build -- TypeScript can import ShootingStarsLayer from layers barrel</verify>
  <done>ShootingStarsLayer exported from layers/index.ts in alphabetical order</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds with no errors
- [ ] ShootingStarsLayer implements all Layer interface methods
- [ ] Spawn rate is ~1% (0.01 chance per frame)
- [ ] Maximum concurrent stars is 3
- [ ] Trail length is 35-50px with gradient fade
- [ ] Stars move diagonally (down and left)
- [ ] Stars spawn in upper viewport only
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- ShootingStarsLayer ready for integration in Phase 89
</success_criteria>

<output>
After completion, create `.planning/phases/87-shooting-stars-layer/87-01-SUMMARY.md`
</output>
