---
phase: 01-foundation
plan: 02
type: execute
---

<objective>
Establish proper Electron main/renderer process structure following the spec architecture.

Purpose: Create the foundational process separation that enables secure IPC and proper Electron patterns.
Output: Clean main process entry, preload script, and renderer React app structure matching DAGENT_SPEC.md section 2.2.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@DAGENT_SPEC.md

**Architecture from spec (section 2.2):**
```
Electron Main Process
├── Auth Manager
├── Git Manager
└── Agent Process Manager
         │
         │ IPC
         ▼
Electron Renderer Process
├── Kanban View
├── DAG View
└── Context View
```

**Depends on:** 01-01 (project scaffolding complete)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure main process</name>
  <files>src/main/index.ts, src/main/window.ts</files>
  <action>
    Refactor the electron-vite default main process to match our architecture:

    src/main/index.ts:
    - Clean app lifecycle (app.whenReady, app.on('window-all-closed'))
    - Import and call createWindow from window.ts
    - Placeholder comments for future managers: // TODO: Auth Manager, Git Manager, Agent Manager

    src/main/window.ts:
    - Export createWindow function
    - BrowserWindow configuration:
      - width: 1200, height: 800 (reasonable default)
      - webPreferences.preload: path to preload script
      - webPreferences.contextIsolation: true (security)
      - webPreferences.nodeIntegration: false (security)
    - Load renderer URL (dev vs prod handling)

    Follow electron-vite conventions for dev/prod URL handling.
  </action>
  <verify>npm run dev still opens window, no console errors in main process</verify>
  <done>Main process cleanly separated into index.ts (lifecycle) and window.ts (window creation)</done>
</task>

<task type="auto">
  <name>Task 2: Configure secure preload script</name>
  <files>src/preload/index.ts, src/preload/index.d.ts</files>
  <action>
    Set up preload script with contextBridge for secure IPC:

    src/preload/index.ts:
    ```typescript
    import { contextBridge, ipcRenderer } from 'electron'

    // Expose protected methods for renderer
    contextBridge.exposeInMainWorld('electronAPI', {
      // Placeholder for future IPC methods
      ping: () => ipcRenderer.invoke('ping'),
    })
    ```

    src/preload/index.d.ts (TypeScript declarations):
    ```typescript
    export interface ElectronAPI {
      ping: () => Promise<string>
    }

    declare global {
      interface Window {
        electronAPI: ElectronAPI
      }
    }
    ```

    This establishes the pattern - actual IPC methods added in 01-03.

    IMPORTANT: Never expose raw ipcRenderer. Always wrap in specific methods.
  </action>
  <verify>TypeScript compiles without errors, window.electronAPI available in renderer DevTools</verify>
  <done>Preload script exposes electronAPI, TypeScript types available in renderer</done>
</task>

<task type="auto">
  <name>Task 3: Set up renderer React structure</name>
  <files>src/renderer/src/App.tsx, src/renderer/src/main.tsx, src/renderer/index.html</files>
  <action>
    Clean up renderer to establish our component structure:

    src/renderer/src/main.tsx:
    - Standard React 18 createRoot entry
    - Import global CSS (Tailwind)
    - Render App component

    src/renderer/src/App.tsx:
    - Simple functional component
    - Placeholder for future tab navigation
    - Test Tailwind with basic styling
    - Display "DAGent" title with spec color scheme (use blue-500 for now)

    Example App.tsx:
    ```tsx
    function App() {
      return (
        <div className="min-h-screen bg-gray-900 text-white">
          <header className="p-4 border-b border-gray-700">
            <h1 className="text-xl font-bold text-blue-400">DAGent</h1>
          </header>
          <main className="p-4">
            <p className="text-gray-400">Dependency-aware AI agent orchestration</p>
          </main>
        </div>
      )
    }
    ```

    Keep it minimal - views added in Phase 6.
  </action>
  <verify>npm run dev shows styled app with DAGent header, no React errors in console</verify>
  <done>Clean React app structure with Tailwind styling, ready for views</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Main process split into index.ts and window.ts
- [ ] Preload script uses contextBridge correctly
- [ ] window.electronAPI accessible in renderer DevTools
- [ ] React app renders with Tailwind styling
- [ ] No security warnings in console (nodeIntegration: false, contextIsolation: true)
</verification>

<success_criteria>
- All tasks completed
- Clean separation of main/preload/renderer
- Secure Electron configuration
- TypeScript types for IPC bridge
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
