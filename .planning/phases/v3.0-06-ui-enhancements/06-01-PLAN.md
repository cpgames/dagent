---
phase: v3.0-06-ui-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/components/Chat/SessionStatus.tsx
  - src/renderer/src/components/Chat/SessionStatus.css
  - src/renderer/src/components/Chat/CheckpointViewer.tsx
  - src/renderer/src/components/Chat/CheckpointViewer.css
  - src/renderer/src/components/Chat/index.ts
autonomous: true
must_haves:
  truths:
    - "User can see current token count in chat panel"
    - "User can see checkpoint version and compaction count"
    - "User can view checkpoint summary (completed, pending, decisions, blockers)"
    - "Session status updates in real-time during compaction"
  artifacts:
    - path: "src/renderer/src/components/Chat/SessionStatus.tsx"
      provides: "Token count and compaction metrics display"
      exports: ["SessionStatus"]
    - path: "src/renderer/src/components/Chat/CheckpointViewer.tsx"
      provides: "Checkpoint summary display with collapsible sections"
      exports: ["CheckpointViewer"]
  key_links:
    - from: "SessionStatus.tsx"
      to: "session API"
      via: "window.api.session.getMetrics"
      pattern: "getMetrics"
    - from: "CheckpointViewer.tsx"
      to: "session API"
      via: "window.api.session.getCheckpoint"
      pattern: "getCheckpoint"
---

<objective>
Create session status indicator and checkpoint viewer components for the chat panel.

Purpose: Give users visibility into session health (token usage, compaction) and checkpoint state (work progress).
Output: Two React components for displaying session metrics and checkpoint data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v3.0-session-checkpoint-ROADMAP.md
@.planning/phases/v3.0-05-dev-agent-integration/05-01-SUMMARY.md

@src/renderer/src/components/Chat/ChatPanel.tsx
@src/renderer/src/components/Chat/ChatPanel.css
@src/preload/index.d.ts
@src/shared/types/session.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SessionStatus component</name>
  <files>src/renderer/src/components/Chat/SessionStatus.tsx, src/renderer/src/components/Chat/SessionStatus.css</files>
  <action>
    Create a compact status indicator component that displays:

    1. **Token count** - Current tokens used (from getMetrics)
    2. **Checkpoint version** - Version number with "v" prefix
    3. **Compaction count** - Total compactions performed
    4. **Warning indicator** - Show warning icon when tokens > 80k (approaching 100k limit)

    Component structure:
    ```typescript
    interface SessionStatusProps {
      sessionId: string | null
      featureId: string
      projectRoot: string
    }

    export function SessionStatus({ sessionId, featureId, projectRoot }: SessionStatusProps): JSX.Element
    ```

    Implementation details:
    - Use useEffect to load metrics on mount and when sessionId changes
    - Subscribe to compaction events to update in real-time:
      - onCompactionStart: Show "Compacting..." indicator
      - onCompactionComplete: Refresh metrics
    - Use CSS custom properties for theming (follow existing Chat component patterns)
    - Display as a horizontal row of stat items with icons
    - If sessionId is null, show "No session" state

    Visual design:
    - Small font (12px), muted colors
    - Icons: token icon, version icon, sync/refresh icon
    - Warning: yellow/orange color when tokens > 80k
    - Inline layout to fit in chat header or footer area

    CSS classes: session-status, session-status__item, session-status__icon, session-status__warning
  </action>
  <verify>npm run build succeeds, component exports correctly</verify>
  <done>SessionStatus component displays token count, checkpoint version, compaction count with warning indicator</done>
</task>

<task type="auto">
  <name>Task 2: Create CheckpointViewer component</name>
  <files>src/renderer/src/components/Chat/CheckpointViewer.tsx, src/renderer/src/components/Chat/CheckpointViewer.css</files>
  <action>
    Create an expandable checkpoint viewer that displays the Checkpoint.summary sections:

    1. **Completed** - List of completed items (green checkmarks)
    2. **In Progress** - Currently working on (blue dots)
    3. **Pending** - Still to do (gray dots)
    4. **Blockers** - Issues blocking progress (red warning)
    5. **Decisions** - Key decisions made (purple info icon)

    Component structure:
    ```typescript
    interface CheckpointViewerProps {
      sessionId: string | null
      featureId: string
      projectRoot: string
      isOpen?: boolean
      onToggle?: () => void
    }

    export function CheckpointViewer({ sessionId, featureId, projectRoot, isOpen, onToggle }: CheckpointViewerProps): JSX.Element
    ```

    Implementation details:
    - Collapsible accordion-style sections
    - Each section can be expanded/collapsed independently
    - Show counts in section headers (e.g., "Completed (5)")
    - Empty sections show "None" in muted text
    - Subscribe to compaction complete events to refresh
    - Graceful handling of null checkpoint (show "No checkpoint yet")

    Visual design:
    - Card-style container with border
    - Section headers are clickable to expand/collapse
    - Use CSS custom properties for theming
    - Icons for each section type (check, spinner, clock, alert, lightbulb)
    - Subtle animations for expand/collapse

    CSS classes: checkpoint-viewer, checkpoint-viewer__section, checkpoint-viewer__header, checkpoint-viewer__content, checkpoint-viewer__item
  </action>
  <verify>npm run build succeeds, component exports correctly</verify>
  <done>CheckpointViewer displays all checkpoint sections with expand/collapse functionality</done>
</task>

<task type="auto">
  <name>Task 3: Export components from Chat barrel file</name>
  <files>src/renderer/src/components/Chat/index.ts</files>
  <action>
    Add exports for the new components to the Chat components barrel file.

    If index.ts doesn't exist, create it with exports for all Chat components:
    ```typescript
    export { ChatPanel } from './ChatPanel'
    export { ChatMessage } from './ChatMessage'
    export { ToolUsageDisplay } from './ToolUsageDisplay'
    export { SessionStatus } from './SessionStatus'
    export { CheckpointViewer } from './CheckpointViewer'
    ```

    If index.ts exists, add only the new exports:
    ```typescript
    export { SessionStatus } from './SessionStatus'
    export { CheckpointViewer } from './CheckpointViewer'
    ```
  </action>
  <verify>npm run build succeeds, exports resolve correctly</verify>
  <done>SessionStatus and CheckpointViewer exported from Chat barrel file</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] SessionStatus.tsx created with token count, version, compaction count display
- [ ] SessionStatus shows warning when tokens > 80k
- [ ] CheckpointViewer.tsx created with collapsible sections
- [ ] CheckpointViewer handles empty/null checkpoint gracefully
- [ ] Both components use CSS custom properties for theming
- [ ] Components exported from Chat barrel file
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Components follow existing Chat panel styling patterns
</success_criteria>

<output>
After completion, create `.planning/phases/v3.0-06-ui-enhancements/06-01-SUMMARY.md`
</output>
