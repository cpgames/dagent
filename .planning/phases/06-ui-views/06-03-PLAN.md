---
phase: 06-ui-views
plan: 03
type: execute
---

<objective>
Implement DAG view with React Flow graph for task visualization.

Purpose: Enable visual task management with drag-to-connect dependencies.
Output: Working DAG graph with nodes, edges, and interaction per DAGENT_SPEC 3.2.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-ui-views/06-01-SUMMARY.md
@.planning/phases/06-ui-views/06-02-SUMMARY.md
@src/renderer/src/stores/dag-store.ts
@src/shared/types/index.ts

**Tech stack available:** React, TypeScript, Tailwind CSS, Zustand
**New dependency:** @xyflow/react (React Flow v12) - install this

**Established patterns:**
- useDAGStore with dag, selectedNodeId, addNode, updateNode, removeNode, addConnection, removeConnection
- Task type with id, title, description, status, locked, position
- Connection type with from, to

**From DAGENT_SPEC 3.2:**
- Feature tabs at top showing all features (colored by status)
- Graph canvas with draggable nodes
- Sidebar for feature chat (implement in 06-05)
- Control bar: Play, Stop, Undo, Redo

**From DAGENT_SPEC 11.2 (Node design):**
- Lock icon if locked
- Title
- Edit and Delete buttons
- Connection handles for drag-to-connect
- Background/border color by status
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install React Flow and create TaskNode component</name>
  <files>package.json, src/renderer/src/components/DAG/TaskNode.tsx, src/renderer/src/components/DAG/index.ts</files>
  <action>
Install @xyflow/react:
```bash
npm install @xyflow/react
```

Create custom TaskNode component for React Flow:

```tsx
import { Handle, Position, NodeProps } from '@xyflow/react';
import type { Task } from '@shared/types';

interface TaskNodeData {
  task: Task;
  onEdit: (taskId: string) => void;
  onDelete: (taskId: string) => void;
}

export function TaskNode({ data }: NodeProps<TaskNodeData>) {
  const { task, onEdit, onDelete } = data;
  // ...
}
```

Node styling per DAGENT_SPEC 11.2:
- min-w-[180px] rounded-lg shadow-lg
- Border color based on task.status (blue/yellow/green/red)
- Header: lock icon (if locked), title, edit/delete buttons
- Source handle on right, target handle on left
- Status colors:
  - blocked/ready: border-blue-500
  - running/merging: border-yellow-500
  - completed: border-green-500
  - failed: border-red-500

Don't forget to import React Flow's CSS in the parent component.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>TaskNode component renders task with status styling and handles</done>
</task>

<task type="auto">
  <name>Task 2: Create FeatureTabs component</name>
  <files>src/renderer/src/components/DAG/FeatureTabs.tsx</files>
  <action>
Create FeatureTabs showing all features with status colors:

```tsx
interface FeatureTabsProps {
  features: Feature[];
  activeFeatureId: string | null;
  onSelectFeature: (featureId: string) => void;
}
```

Per DAGENT_SPEC 11.3:
- Horizontal scrollable tab list
- Each tab shows feature name with status color indicator
- Active tab has distinct styling (darker bg, ring)
- Tab colors: left border or dot using status color

Layout:
```tsx
<div className="flex gap-2 overflow-x-auto pb-2">
  {features.map(f => (
    <button
      key={f.id}
      onClick={() => onSelectFeature(f.id)}
      className={`px-3 py-1.5 rounded-t text-sm whitespace-nowrap
        border-l-4 ${getStatusBorderColor(f.status)}
        ${f.id === activeFeatureId ? 'bg-gray-700' : 'bg-gray-800 hover:bg-gray-700'}`}
    >
      {f.name}
    </button>
  ))}
</div>
```
  </action>
  <verify>npm run typecheck passes</verify>
  <done>FeatureTabs shows features with status colors and selection state</done>
</task>

<task type="auto">
  <name>Task 3: Implement DAGView with React Flow canvas</name>
  <files>src/renderer/src/views/DAGView.tsx</files>
  <action>
Replace placeholder with full DAG implementation:

1. Import React Flow components and CSS
2. Import useFeatureStore, useDAGStore, FeatureTabs, TaskNode
3. Convert dag nodes/connections to React Flow format
4. Handle node position changes (updateNode with new position)
5. Handle new connections (addConnection)
6. Handle node deletion (removeNode + removeConnection for affected edges)
7. Add control bar with placeholder Play/Stop/Undo/Redo buttons

Structure:
```tsx
import { ReactFlow, Background, Controls, MiniMap, useNodesState, useEdgesState } from '@xyflow/react';
import '@xyflow/react/dist/style.css';

// Register custom node type
const nodeTypes = { taskNode: TaskNode };

export default function DAGView() {
  const { features, activeFeatureId, setActiveFeature } = useFeatureStore();
  const { dag, updateNode, addConnection } = useDAGStore();

  // Convert DAG to React Flow format
  const [nodes, setNodes, onNodesChange] = useNodesState(dagToNodes(dag));
  const [edges, setEdges, onEdgesChange] = useEdgesState(dagToEdges(dag));

  // ...
}
```

Layout:
- FeatureTabs at top
- ReactFlow canvas filling remaining space
- Controls and MiniMap for navigation
- Control bar at bottom with execution buttons (disabled for now)
  </action>
  <verify>npm run dev shows DAG graph with nodes and edges, drag works</verify>
  <done>DAGView renders React Flow graph with TaskNodes and connections</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes
- [ ] React Flow renders without errors
- [ ] Task nodes display with correct status colors
- [ ] Nodes are draggable and positions persist
- [ ] Connections display between dependent tasks
- [ ] Feature tabs show all features with status colors
- [ ] Selecting a feature tab loads its DAG
</verification>

<success_criteria>
- React Flow installed and configured
- TaskNode component with status styling and handles
- FeatureTabs component for feature selection
- DAGView renders interactive graph
</success_criteria>

<output>
After completion, create `.planning/phases/06-ui-views/06-03-SUMMARY.md`
</output>
