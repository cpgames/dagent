# Phase 31-01: Task Selection Context

## Goal
Remove the separate Task Chat overlay and instead pass selected task context to the PM Agent, so it automatically knows which task the user is focused on.

## Current State
- TaskChat component overlays FeatureChat when task chat button clicked
- dialog-store has taskChatOpen, taskChatTaskId, taskChatFeatureId state
- TaskNode has "Chat" button that opens TaskChat
- dag-store already has selectedNodeId for tracking node selection
- PM agent receives feature context via autoContext but no selected task info

## Implementation

### Step 1: Remove TaskChat components and state
Files to modify:
- `src/renderer/src/components/Chat/index.ts` - Remove TaskChat export
- `src/renderer/src/views/DAGView.tsx` - Remove TaskChat import, rendering, and handleChatTask
- `src/renderer/src/stores/dialog-store.ts` - Remove taskChat state and actions
- `src/renderer/src/components/DAG/TaskNode.tsx` - Remove chat button and onChat handler

### Step 2: Track selected task in React Flow
Files to modify:
- `src/renderer/src/views/DAGView.tsx` - Track selected node, update dag-store on selection
- Connect node click to setSelectedNode in dag-store

### Step 3: Pass selected task to chat context
Files to modify:
- `src/renderer/src/stores/chat-store.ts` - Add selectedTaskId to sendToAgent query
- `src/main/agent/agent-service.ts` - Accept selectedTaskId in query options
- `src/main/agent/prompt-builders.ts` - Include selected task in prompt

### Step 4: Update PM agent instructions for task awareness
Files to modify:
- `src/main/agent/prompt-builders.ts` - Add instructions for task selection awareness

## Verification
1. Chat button removed from TaskNode - PASS/FAIL
2. TaskChat overlay no longer appears - PASS/FAIL
3. Clicking task node selects it (visual feedback already exists) - PASS/FAIL
4. PM agent responds with selected task info when asked - PASS/FAIL
5. PM agent can create tasks relative to selected task - PASS/FAIL

## Files Changed
- src/renderer/src/components/Chat/index.ts
- src/renderer/src/components/Chat/TaskChat.tsx (DELETE)
- src/renderer/src/views/DAGView.tsx
- src/renderer/src/stores/dialog-store.ts
- src/renderer/src/stores/chat-store.ts
- src/renderer/src/components/DAG/TaskNode.tsx
- src/main/agent/agent-service.ts
- src/main/agent/prompt-builders.ts
