---
phase: v3.1-01-task-status-extension
plan: 03
type: execute
wave: 2
depends_on: ["v3.1-01-01"]
files_modified:
  - src/main/agent/pm-agent-manager.ts
  - src/main/agent/prompt-builders.ts
autonomous: true
must_haves:
  truths:
    - "PM planning prompt only instructs to create feature-spec.md"
    - "PM planning prompt does NOT instruct to create tasks"
    - "Planning verification only checks for spec.md existence"
  artifacts:
    - path: "src/main/agent/pm-agent-manager.ts"
      provides: "Updated planning prompt and verification"
    - path: "src/main/agent/prompt-builders.ts"
      provides: "PM role instructions without initial task creation"
  key_links:
    - from: "buildPlanningPrompt"
      to: "verifyPlanningComplete"
      via: "Spec-only workflow"
---

<objective>
Update PM planning prompt to only create spec.md (not tasks).

Purpose: Task creation is now handled by the orchestrator-based analysis loop, not the initial planning phase.
Output: PM planning creates spec only, verification checks spec only.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v3.1-task-analysis-orchestrator-ROADMAP.md

@src/main/agent/pm-agent-manager.ts
@src/main/agent/prompt-builders.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update buildPlanningPrompt to spec-only</name>
  <files>src/main/agent/pm-agent-manager.ts</files>
  <action>
    1. Find the `buildPlanningPrompt()` method

    2. Replace the workflow section to focus ONLY on spec creation:

       ```typescript
       private buildPlanningPrompt(featureName: string, context: string): string {
         return `You are the PM Agent for a new feature: "${featureName}".

       Your task is to create a feature specification.

       ${context ? `\n${context}\n` : ''}

       **Your workflow:**

       1. **Create Feature Specification**:
          - Use the CreateSpec tool to create a feature-spec.md file
          - Include goals, requirements, and acceptance criteria
          - Base the spec on the feature name${context ? ', description, and attached files' : ''}

       2. **Verification**:
          - Ensure spec is created with meaningful content
          - Your work is complete when the spec is saved

       **Important:**
       - This is autonomous - do not wait for user input
       - Create the spec, then finish
       - Do NOT create tasks - task creation happens in the analysis phase
       - The system will analyze and create tasks after planning completes

       Begin planning for "${featureName}".`;
       }
       ```

    Key changes:
    - Removed "Create Task(s)" section entirely
    - Removed task judgment/decomposition instructions
    - Added explicit "Do NOT create tasks" instruction
    - Simplified workflow to spec creation only
  </action>
  <verify>TypeScript compiles</verify>
  <done>buildPlanningPrompt creates spec-only instructions</done>
</task>

<task type="auto">
  <name>Task 2: Update verifyPlanningComplete to check spec only</name>
  <files>src/main/agent/pm-agent-manager.ts</files>
  <action>
    1. Find the `verifyPlanningComplete()` method

    2. Remove the DAG/task verification - only check for spec.md:

       ```typescript
       private async verifyPlanningComplete(featureId: string): Promise<boolean> {
         try {
           // Check: Verify spec.md exists
           const featureDir = getFeatureDir(this.projectRoot, featureId)
           const specPath = path.join(featureDir, 'feature-spec.md')

           try {
             await fs.access(specPath)
           } catch {
             console.error(`[PMAgentManager] Verification failed: spec.md not found at ${specPath}`)
             return false
           }

           // Spec exists - planning complete
           // Note: Tasks are created by the analysis orchestrator, not during planning
           console.log(`[PMAgentManager] Verification passed: spec.md exists`)
           return true
         } catch (error) {
           console.error(`[PMAgentManager] Verification error:`, error)
           return false
         }
       }
       ```

    Key changes:
    - Removed DAG verification (Check 2)
    - Updated success log message
    - Added comment explaining tasks come from analysis phase
  </action>
  <verify>TypeScript compiles</verify>
  <done>verifyPlanningComplete only checks for spec.md</done>
</task>

<task type="auto">
  <name>Task 3: Update PM role instructions for interactive chat</name>
  <files>src/main/agent/prompt-builders.ts</files>
  <action>
    1. Find the `getAgentRoleInstructions()` function, case 'pm'

    2. Update the task decomposition section to clarify the new workflow:

       In the "## Task Decomposition - USE JUDGMENT" section, add a note at the top:

       ```typescript
       ## Task Management
       - When in PLANNING mode: Do NOT create tasks. Only create the feature spec.
       - When in INTERACTIVE mode (user requests): You CAN create/modify tasks via DAGAddNode
       - Tasks start as needs_analysis and get analyzed by the orchestrator
       ```

    3. Keep the existing task decomposition guidance but frame it as "when user explicitly requests task creation"

    The PM agent should still be able to create tasks when the user asks, but should NOT create them automatically during the initial planning phase.
  </action>
  <verify>TypeScript compiles</verify>
  <done>PM role instructions clarify planning vs interactive task creation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] buildPlanningPrompt mentions spec creation, NOT task creation
- [ ] buildPlanningPrompt explicitly says "Do NOT create tasks"
- [ ] verifyPlanningComplete only checks for spec.md
- [ ] PM role instructions distinguish planning mode from interactive mode
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- PM planning workflow focuses on spec creation only
- PM can still create tasks when user explicitly requests in interactive chat
</success_criteria>

<output>
After completion, create `.planning/phases/v3.1-01-task-status-extension/v3.1-01-03-SUMMARY.md`
</output>
