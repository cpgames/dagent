---
phase: v3.1-01-task-status-extension
plan: 02
type: execute
wave: 2
depends_on: ["v3.1-01-01"]
files_modified:
  - src/main/storage/feature-store.ts
  - src/main/storage/paths.ts
autonomous: true
must_haves:
  truths:
    - "Creating a feature auto-creates a single task with needs_analysis status"
    - "The auto-created task has the feature name as title"
    - "The auto-created task has the feature description (if any) as description"
  artifacts:
    - path: "src/main/storage/feature-store.ts"
      provides: "Auto-task creation in createFeature"
      contains: "needs_analysis"
  key_links:
    - from: "FeatureStore.createFeature"
      to: "saveDag"
      via: "Creates initial DAG with single task"
      pattern: "saveDag.*nodes.*needs_analysis"
---

<objective>
Update feature creation to automatically create a single task with `needs_analysis` status.

Purpose: When a feature is created, it should start with one task representing the entire feature scope, ready for PM analysis.
Output: Feature creation flow that produces both feature.json and dag.json with initial task.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v3.1-task-analysis-orchestrator-ROADMAP.md
@.planning/phases/v3.1-01-task-status-extension/v3.1-01-01-SUMMARY.md

@src/shared/types/task.ts
@src/shared/types/dag.ts
@src/main/storage/feature-store.ts
@src/main/storage/paths.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Auto-create initial task in createFeature</name>
  <files>src/main/storage/feature-store.ts</files>
  <action>
    1. Import Task type if not already imported:
       ```typescript
       import type { Feature, DAGGraph, Task, ... } from '@shared/types';
       ```

    2. In `createFeature()` method, after saving the feature, create an initial DAG with one task:

       ```typescript
       // Create initial task for the feature
       const initialTask: Task = {
         id: `task-${slug}-initial`,
         title: name,  // Feature name becomes task title
         description: options?.description || '',  // Feature description becomes task description
         status: 'needs_analysis',
         locked: false,
         position: { x: 250, y: 100 }  // Centered position
       };

       // Create initial DAG with the single task
       const initialDag: DAGGraph = {
         nodes: [initialTask],
         connections: []
       };

       // Save the DAG
       await this.saveDag(id, initialDag);
       ```

    3. Place this code AFTER `await this.saveFeature(feature)` but BEFORE `return feature`.

    The key insight: every new feature starts with exactly one task that encompasses the entire feature scope. The PM agent will later analyze this task and decide whether to keep it or split it.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>createFeature() creates feature AND initial DAG with one needs_analysis task</done>
</task>

<task type="auto">
  <name>Task 2: Verify DAGGraph type compatibility</name>
  <files>src/shared/types/dag.ts</files>
  <action>
    1. Read the DAGGraph type definition to confirm it accepts Task[] for nodes
    2. If any type adjustments are needed, make them
    3. Most likely NO changes needed - just verification

    This is a verification step to ensure our Task creation is compatible with the DAG system.
  </action>
  <verify>TypeScript compiles without type errors</verify>
  <done>DAGGraph type confirmed compatible with Task[] including needs_analysis status</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] TypeScript compilation passes
- [ ] createFeature() saves both feature.json and dag.json
- [ ] Initial task has:
  - id: `task-{slug}-initial`
  - title: feature name
  - description: feature description (or empty string)
  - status: 'needs_analysis'
  - position: centered
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- New features automatically get one needs_analysis task
</success_criteria>

<output>
After completion, create `.planning/phases/v3.1-01-task-status-extension/v3.1-01-02-SUMMARY.md`
</output>
