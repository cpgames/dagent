---
phase: 54-github-pr-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/github/pr-types.ts
  - src/main/github/pr-service.ts
  - src/main/github/index.ts
  - src/main/ipc/pr-handlers.ts
  - src/main/ipc/handlers.ts
  - src/preload/index.ts
  - src/preload/index.d.ts
autonomous: true

must_haves:
  truths:
    - "PRService can detect if gh CLI is available"
    - "PRService can create a pull request via gh CLI"
    - "IPC handlers expose PR operations to renderer"
  artifacts:
    - path: "src/main/github/pr-service.ts"
      provides: "GitHub CLI wrapper service"
      min_lines: 80
      exports: ["PRService", "getPRService"]
    - path: "src/main/github/pr-types.ts"
      provides: "TypeScript types for PR operations"
      exports: ["CreatePRRequest", "CreatePRResult", "PROperationResult"]
    - path: "src/main/ipc/pr-handlers.ts"
      provides: "IPC handlers for PR operations"
      exports: ["registerPRHandlers"]
  key_links:
    - from: "src/main/ipc/pr-handlers.ts"
      to: "src/main/github/pr-service.ts"
      via: "getPRService import"
      pattern: "getPRService"
    - from: "src/main/ipc/handlers.ts"
      to: "src/main/ipc/pr-handlers.ts"
      via: "registerPRHandlers call"
      pattern: "registerPRHandlers"
---

<objective>
Create PRService to wrap GitHub CLI (`gh`) for pull request operations.

Purpose: Enable PR creation as an alternative to AI-powered merge for completed features.
Output: PRService class with gh CLI integration, types, IPC handlers, and preload API.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/53-feature-merge-agent/53-01-SUMMARY.md

@src/main/git/git-manager.ts
@src/main/ipc/handlers.ts
@src/preload/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PR types and PRService</name>
  <files>src/main/github/pr-types.ts, src/main/github/pr-service.ts, src/main/github/index.ts</files>
  <action>
Create new `src/main/github/` directory with:

**pr-types.ts:**
```typescript
export interface PROperationResult {
  success: boolean
  error?: string
}

export interface CreatePRRequest {
  title: string
  body: string
  head: string      // Feature branch name
  base: string      // Target branch (usually 'main')
  draft?: boolean
}

export interface CreatePRResult extends PROperationResult {
  prNumber?: number
  prUrl?: string
  htmlUrl?: string
}

export interface GhCliStatus {
  installed: boolean
  authenticated: boolean
  error?: string
}
```

**pr-service.ts:**
- Create `PRService` class that wraps `gh` CLI commands
- Use `child_process.execFile` for running gh commands (safer than exec)
- Methods:
  - `checkGhCli(): Promise<GhCliStatus>` - Check if gh CLI is installed and authenticated
  - `createPullRequest(req: CreatePRRequest): Promise<CreatePRResult>` - Run `gh pr create`
- Parse JSON output from gh commands (use `--json` flag)
- Handle errors gracefully, return typed results
- Singleton pattern: `getPRService()`

**index.ts:**
- Export all types from pr-types.ts
- Export PRService and getPRService from pr-service.ts
  </action>
  <verify>tsc --noEmit src/main/github/*.ts</verify>
  <done>PRService class created with gh CLI wrapper methods</done>
</task>

<task type="auto">
  <name>Task 2: Create IPC handlers and preload API</name>
  <files>src/main/ipc/pr-handlers.ts, src/main/ipc/handlers.ts, src/preload/index.ts, src/preload/index.d.ts</files>
  <action>
**pr-handlers.ts:**
Create IPC handlers following existing patterns:
```typescript
import { ipcMain } from 'electron'
import { getPRService } from '../github'

export function registerPRHandlers(): void {
  ipcMain.handle('pr:check-gh-cli', async () => {
    return getPRService().checkGhCli()
  })

  ipcMain.handle('pr:create', async (_event, request: CreatePRRequest) => {
    return getPRService().createPullRequest(request)
  })
}
```

**handlers.ts:**
- Import and register: `import { registerPRHandlers } from './pr-handlers'`
- Add call to `registerPRHandlers()` in `registerIpcHandlers()`

**preload/index.ts:**
Add to contextBridge.exposeInMainWorld('api', {...}):
```typescript
pr: {
  checkGhCli: () => ipcRenderer.invoke('pr:check-gh-cli'),
  create: (request: CreatePRRequest) => ipcRenderer.invoke('pr:create', request)
}
```

**preload/index.d.ts:**
Add types for the pr namespace in the API interface.
  </action>
  <verify>npm run build</verify>
  <done>IPC handlers registered and preload API exposes PR operations</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] PRService.checkGhCli() method exists and handles missing CLI gracefully
- [ ] PRService.createPullRequest() method exists with proper types
- [ ] IPC handlers registered in handlers.ts
- [ ] Preload API exposes pr.checkGhCli and pr.create
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- PRService wraps gh CLI commands correctly
- IPC layer connects main process to renderer
</success_criteria>

<output>
After completion, create `.planning/phases/54-github-pr-integration/54-01-SUMMARY.md`
</output>
