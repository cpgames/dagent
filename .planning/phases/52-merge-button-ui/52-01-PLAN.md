---
phase: 52-merge-button-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/components/Kanban/FeatureCard.tsx
  - src/renderer/src/components/Kanban/KanbanColumn.tsx
  - src/renderer/src/components/Kanban/KanbanView.tsx
autonomous: true

must_haves:
  truths:
    - "User sees Merge button on completed features in Kanban"
    - "Clicking Merge shows dropdown with AI Merge and Create PR options"
    - "Selecting an option triggers appropriate handler and closes dropdown"
  artifacts:
    - path: "src/renderer/src/components/Kanban/FeatureCard.tsx"
      provides: "Merge button with dropdown UI on completed features"
      contains: "onMerge"
    - path: "src/renderer/src/components/Kanban/KanbanColumn.tsx"
      provides: "Merge handler prop passing"
      contains: "onMergeFeature"
  key_links:
    - from: "FeatureCard.tsx"
      to: "KanbanColumn.tsx"
      via: "onMerge prop"
      pattern: "onMerge.*featureId.*mergeType"
---

<objective>
Add "Merge" button to completed features in Kanban board with dropdown options.

Purpose: Enable users to initiate merge workflow from Kanban UI for completed features.
Output: Merge button visible on completed features with AI Merge / Create PR options.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/renderer/src/components/Kanban/FeatureCard.tsx
@src/renderer/src/components/Kanban/KanbanColumn.tsx
@src/renderer/src/components/Kanban/KanbanView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Merge button with dropdown to FeatureCard</name>
  <files>src/renderer/src/components/Kanban/FeatureCard.tsx</files>
  <action>
Add a "Merge" button next to the existing "Archive" button for completed features.

1. Add MergeType type: `type MergeType = 'ai' | 'pr'`

2. Add new prop to FeatureCardProps:
   - `onMerge?: (featureId: string, mergeType: MergeType) => void`

3. Add state for dropdown visibility:
   - `const [showMergeDropdown, setShowMergeDropdown] = useState(false)`

4. Create a MergeIcon SVG component (git merge icon - two branches joining):
   ```tsx
   function MergeIcon(): React.JSX.Element {
     return (
       <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
         <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}
           d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2M8 7H6a2 2 0 00-2 2v8a2 2 0 002 2h2" />
       </svg>
     );
   }
   ```

5. Add Merge button and dropdown in the completed features section (near Archive):
   - Button shows "Merge" text with MergeIcon
   - Clicking button toggles dropdown
   - Dropdown has two options: "AI Merge" and "Create PR"
   - Each option calls `onMerge(feature.id, 'ai')` or `onMerge(feature.id, 'pr')`
   - Dropdown closes after selection
   - Dropdown positioned below button with absolute positioning

6. Add click-outside handler to close dropdown:
   ```tsx
   useEffect(() => {
     if (!showMergeDropdown) return;
     const handleClickOutside = () => setShowMergeDropdown(false);
     document.addEventListener('click', handleClickOutside);
     return () => document.removeEventListener('click', handleClickOutside);
   }, [showMergeDropdown]);
   ```

Style the button similar to Archive (text-gray-400 hover:text-white) but make it more prominent as a primary action (use text-blue-400 hover:text-blue-300).

Dropdown styling: bg-gray-700 rounded-md shadow-lg py-1, options with px-4 py-2 hover:bg-gray-600
  </action>
  <verify>npm run build succeeds without TypeScript errors</verify>
  <done>Merge button visible on completed feature cards with working dropdown</done>
</task>

<task type="auto">
  <name>Task 2: Wire Merge handler through KanbanColumn and KanbanView</name>
  <files>src/renderer/src/components/Kanban/KanbanColumn.tsx, src/renderer/src/components/Kanban/KanbanView.tsx</files>
  <action>
1. In KanbanColumn.tsx:
   - Import MergeType from FeatureCard (or define locally)
   - Add prop: `onMergeFeature: (featureId: string, mergeType: MergeType) => void`
   - Pass to FeatureCard: `onMerge={status === 'completed' ? onMergeFeature : undefined}`

2. In KanbanView.tsx:
   - Add handler function:
     ```tsx
     const handleMergeFeature = (featureId: string, mergeType: MergeType) => {
       console.log(`Merge feature ${featureId} with type: ${mergeType}`);
       // TODO: Wire to actual merge workflow in Phase 55
     };
     ```
   - Pass to KanbanColumn: `onMergeFeature={handleMergeFeature}`

Export MergeType from FeatureCard.tsx so it can be imported by KanbanColumn and KanbanView.
  </action>
  <verify>npm run build succeeds, clicking dropdown options logs to console</verify>
  <done>Merge handler wired through component hierarchy, ready for Phase 55 integration</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] Completed features show Merge button in Kanban
- [ ] Clicking Merge button shows dropdown with two options
- [ ] Selecting AI Merge logs to console
- [ ] Selecting Create PR logs to console
- [ ] Dropdown closes after selection
- [ ] Clicking outside dropdown closes it
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors or warnings
- UI matches existing Kanban card patterns
</success_criteria>

<output>
After completion, create `.planning/phases/52-merge-button-ui/52-01-SUMMARY.md`
</output>
