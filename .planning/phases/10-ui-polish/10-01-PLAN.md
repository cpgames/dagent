---
phase: 10-ui-polish
plan: 01
type: execute
---

<objective>
Add loading states and feedback for all async operations that currently lack visual indicators.

Purpose: Users need to know when operations are in progress to avoid confusion and prevent duplicate actions.
Output: Consistent loading indicators across all async operations including DAG mutations, history operations, and feature saves.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./10-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior phase:**
@.planning/phases/09-feature-creation/09-03-SUMMARY.md

**Key files:**
@src/renderer/src/stores/dag-store.ts
@src/renderer/src/stores/feature-store.ts
@src/renderer/src/views/DAGView.tsx
@src/renderer/src/views/ContextView.tsx
@src/renderer/src/components/ui/StatusBadge.tsx

**Current state:**
- feature-store: loadFeatures and createFeature have loading states
- dag-store: loadDag has isLoading but mutations (add/update/remove node/connection) do not
- auth-store: Well-implemented with isLoading throughout
- History operations (undo/redo) have no loading states
- ContextView save has isSaving but no visual spinner

**Patterns established:**
- Zustand stores use `isLoading: boolean` state
- Components disable buttons during loading with "...ing" text
- StatusBadge component available for consistent styling
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add loading states for DAG mutations in dag-store</name>
  <files>src/renderer/src/stores/dag-store.ts</files>
  <action>
Add `isMutating: boolean` state to DAGStore interface and initial state.

For each mutation method (addNode, updateNode, removeNode, addConnection, removeConnection):
1. Set `isMutating: true` at start of method
2. Set `isMutating: false` in finally block

Export `isMutating` from the store selector.
  </action>
  <verification>
- Build passes with no type errors
- isMutating is accessible from components
  </verification>
</task>

<task type="auto">
  <name>Task 2: Add loading states for history operations</name>
  <files>src/renderer/src/stores/dag-store.ts</files>
  <action>
Add `isUndoing: boolean` and `isRedoing: boolean` to DAGStore state.

In undo() method:
1. Set `isUndoing: true` at start
2. Set `isUndoing: false` in finally block

In redo() method:
1. Set `isRedoing: true` at start
2. Set `isRedoing: false` in finally block

Export these states from the store.
  </action>
  <verification>
- undo() and redo() set loading states correctly
- States reset even on error (finally block)
  </verification>
</task>

<task type="auto">
  <name>Task 3: Show DAG mutation loading indicator in DAGView</name>
  <files>src/renderer/src/views/DAGView.tsx</files>
  <action>
Import `isMutating` from dag-store.

Add a subtle loading indicator when `isMutating` is true:
1. Add a small spinning indicator in the top-right of the ReactFlow container
2. Use a div with absolute positioning: "absolute top-2 right-2 z-10"
3. Show pulsing dot (similar to ExecutionControls pattern) with "Saving..." text
4. Only visible when isMutating is true
  </action>
  <verification>
- Indicator appears during node/connection mutations
- Indicator disappears when mutation completes
- Does not interfere with ReactFlow interactions
  </verification>
</task>

<task type="auto">
  <name>Task 4: Show undo/redo loading in ExecutionControls</name>
  <files>src/renderer/src/components/DAG/ExecutionControls.tsx</files>
  <action>
Import `isUndoing` and `isRedoing` from dag-store.

Update undo button:
1. Disable when `isUndoing` is true (in addition to !canUndo)
2. Add spinning animation to icon when isUndoing

Update redo button:
1. Disable when `isRedoing` is true (in addition to !canRedo)
2. Add spinning animation to icon when isRedoing

Use Tailwind animate-spin class for the spinning effect.
  </action>
  <verification>
- Undo/redo buttons show spinning during operations
- Buttons are disabled during their respective operations
- Operations still work correctly
  </verification>
</task>

<task type="auto">
  <name>Task 5: Add loading spinner to ContextView save button</name>
  <files>src/renderer/src/views/ContextView.tsx</files>
  <action>
Update the "Save to CLAUDE.md" button to show a spinner when saving:
1. When isSaving is true, show a spinner icon before "Saving..."
2. Add a small inline SVG spinner (or use a spinning dot)
3. Keep button disabled during save

Pattern to follow from NewFeatureDialog:
```tsx
{isSaving ? (
  <>
    <span className="animate-spin mr-2">...</span>
    Saving...
  </>
) : 'Save to CLAUDE.md'}
```
  </action>
  <verification>
- Save button shows spinner during save operation
- Button text changes to "Saving..."
- Button is disabled during save
  </verification>
</task>

</tasks>
