---
phase: 10-ui-polish
plan: 02
type: execute
---

<objective>
Fix error display to show user-friendly messages instead of silent console logging.

Purpose: Users must be informed when operations fail so they can take corrective action.
Output: Toast notifications for all async operation failures, error state display in DAGView and ContextView.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./10-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior plan:**
@.planning/phases/10-ui-polish/10-01-PLAN.md

**Key files:**
@src/renderer/src/stores/dag-store.ts
@src/renderer/src/stores/chat-store.ts
@src/renderer/src/views/DAGView.tsx
@src/renderer/src/views/ContextView.tsx
@src/renderer/src/stores/toast-store.ts

**Current error handling:**
- dag-store: Errors logged to console, no toast for history push failures
- chat-store: Silently sets empty messages on error, no notification
- DAGView: No display of dag-store error state
- ContextView: console.log placeholders, no error display

**Patterns established:**
- toast-store provides toast.error(), toast.success() etc.
- Error toasts use 8000ms duration
- ErrorBoundary catches React render errors
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add toast notifications for DAG history push failures</name>
  <files>src/renderer/src/stores/dag-store.ts</files>
  <action>
Import toast from toast-store if not already imported.

In each mutation method (addNode, updateNode, removeNode, addConnection, removeConnection), update the history push error handling:

Change from:
```typescript
} catch (error) {
  console.error('Failed to push version:', error)
}
```

To:
```typescript
} catch (error) {
  console.error('Failed to push version:', error)
  toast.warning('Changes saved but history snapshot failed')
}
```

Use warning (not error) because the operation succeeded, only history failed.
  </action>
  <verification>
- History push failures show warning toast
- Toast message is user-friendly
- Original operation still succeeds
  </verification>
</task>

<task type="auto">
  <name>Task 2: Add toast for chat loading failures</name>
  <files>src/renderer/src/stores/chat-store.ts</files>
  <action>
Import toast from toast-store.

Update the loadChat method's catch block:

Change from:
```typescript
} catch {
  set({ messages: [], isLoading: false })
}
```

To:
```typescript
} catch (error) {
  console.error('Failed to load chat:', error)
  toast.error('Failed to load chat history')
  set({ messages: [], isLoading: false })
}
```
  </action>
  <verification>
- Chat loading failures show error toast
- App still functions with empty messages
  </verification>
</task>

<task type="auto">
  <name>Task 3: Display DAG error state in DAGView</name>
  <files>src/renderer/src/views/DAGView.tsx</files>
  <action>
Import `error` state from dag-store (alongside nodes, connections, etc.).

Add error display below the "Select a feature" message or when there's an error:

```tsx
{error && (
  <div className="absolute top-2 left-2 right-2 z-10 bg-red-900/90 text-red-100 px-3 py-2 rounded-lg text-sm">
    <span className="font-medium">Error:</span> {error}
  </div>
)}
```

Position it as an overlay at the top of the ReactFlow container so it's visible but doesn't break layout.
  </action>
  <verification>
- DAG errors are displayed in the view
- Error banner is dismissible or auto-clears
- Styling matches app theme
  </verification>
</task>

<task type="auto">
  <name>Task 4: Add error state and display to ContextView</name>
  <files>src/renderer/src/views/ContextView.tsx</files>
  <action>
Add error state to the component:
```typescript
const [error, setError] = useState<string | null>(null)
```

Update handleSave to set error state on failure:
```typescript
const handleSave = async () => {
  setError(null)
  setIsSaving(true)
  try {
    // TODO: Implement actual save via IPC
    console.log('Saving CLAUDE.md content:', content)
    await new Promise((resolve) => setTimeout(resolve, 500))
    setLastSynced(new Date())
    toast.success('Context saved')
  } catch (err) {
    const message = err instanceof Error ? err.message : 'Unknown error'
    setError(`Failed to save: ${message}`)
    toast.error('Failed to save context')
  } finally {
    setIsSaving(false)
  }
}
```

Add error display above the textarea:
```tsx
{error && (
  <div className="mb-2 bg-red-900/90 text-red-100 px-3 py-2 rounded-lg text-sm flex justify-between items-center">
    <span>{error}</span>
    <button onClick={() => setError(null)} className="ml-2 hover:text-white">Ã—</button>
  </div>
)}
```
  </action>
  <verification>
- Save errors are caught and displayed
- Error can be dismissed
- Toast also shows for immediate feedback
  </verification>
</task>

<task type="auto">
  <name>Task 5: Add toast for git worktree creation failure in feature-store</name>
  <files>src/renderer/src/stores/feature-store.ts</files>
  <action>
Update the createFeature method's worktree error handling to show a warning toast:

Change from:
```typescript
} catch (worktreeError) {
  console.warn('Failed to create worktree (can be created later):', worktreeError)
}
```

To:
```typescript
} catch (worktreeError) {
  console.warn('Failed to create worktree:', worktreeError)
  toast.warning('Feature created but git worktree setup failed')
}
```

This informs users that something went partially wrong without blocking feature creation.
  </action>
  <verification>
- Worktree failures show warning toast
- Feature creation still succeeds
- User is informed of partial failure
  </verification>
</task>

</tasks>
