---
phase: v3.2-06-context-aware-ui-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/components/DAG/ExecutionControls.tsx
  - src/renderer/src/components/DAG/ExecutionControls.css
autonomous: true

must_haves:
  truths:
    - "DAG header shows feature status badge when in planning phases"
    - "Start button is disabled with tooltip during investigating/questioning/planning states"
    - "Users can see which planning phase the feature is in from the DAG view"
  artifacts:
    - path: "src/renderer/src/components/DAG/ExecutionControls.tsx"
      provides: "Feature state badge and context-aware Start button"
      contains: "feature-state-badge|investigating|questioning|planning"
  key_links:
    - from: "ExecutionControls"
      to: "feature.status"
      via: "conditional badge rendering"
      pattern: "feature\\.status.*investigating|questioning|planning"
---

<objective>
Add feature state badge and context-aware Start button to DAG header (ExecutionControls).

Purpose: DAG view shows current feature planning phase and disables Start button appropriately.
Output: ExecutionControls displays state badge for investigating/questioning/planning and disables Start during these states.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/renderer/src/components/DAG/ExecutionControls.tsx
@src/renderer/src/components/DAG/ExecutionControls.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add feature state badge to ExecutionControls</name>
  <files>src/renderer/src/components/DAG/ExecutionControls.tsx</files>
  <action>
Add a feature state badge that shows the current planning phase next to the status indicator.

1. Create a helper function `getPlanningPhaseBadge(status: FeatureStatus)`:
   - Returns null for non-planning states (not_started, ready, in_progress, completed, archived)
   - Returns badge config for planning states:
     - `investigating`: { label: "Investigating", icon: MagnifyingGlass, color: "primary" }
     - `questioning`: { label: "Questions", icon: QuestionMark, color: "secondary" }
     - `planning`: { label: "Planning", icon: Chart, color: "success" }
     - `creating_worktree`: { label: "Setting up", icon: Spinner, color: "warning" }

2. Add the badge rendering in the controls section:
   - Position: Before or after the status indicator
   - Style: Pill-shaped badge with icon + text
   - Use same icon components from FeatureCard or define inline

3. Badge should be visible when feature is in any planning phase, hidden otherwise.

Import FeatureStatus type if not already imported.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>ExecutionControls shows state badge for planning phases</done>
</task>

<task type="auto">
  <name>Task 2: Style the feature state badge</name>
  <files>src/renderer/src/components/DAG/ExecutionControls.css</files>
  <action>
Add CSS for the feature state badge:

1. `.execution-controls__state-badge` - Base badge styling:
   - Display: inline-flex with gap for icon + text
   - Padding: 0.25rem 0.75rem
   - Border-radius: 9999px (pill shape)
   - Font-size: 0.75rem
   - Text-transform: uppercase
   - Letter-spacing: 0.05em

2. State-specific modifiers:
   - `.execution-controls__state-badge--investigating`: var(--accent-primary) background
   - `.execution-controls__state-badge--questioning`: var(--accent-secondary) background
   - `.execution-controls__state-badge--planning`: var(--color-success) background
   - `.execution-controls__state-badge--creating_worktree`: var(--color-warning) background

3. Badge icon styling:
   - `.execution-controls__state-badge-icon`: 0.875rem size, spin animation for active states

Use color-mix for translucent backgrounds matching the synthwave theme.
  </action>
  <verify>npm run build succeeds</verify>
  <done>State badge has styled appearance matching synthwave theme</done>
</task>

<task type="auto">
  <name>Task 3: Disable Start button during planning phases with tooltip</name>
  <files>src/renderer/src/components/DAG/ExecutionControls.tsx</files>
  <action>
Update Start (Play) button to be disabled during planning phases with explanatory tooltip:

1. Add condition to disable Start button:
   - Currently checks: `isAnalyzing`, execution state
   - Add check: feature.status in ['investigating', 'questioning', 'planning', 'creating_worktree']

2. Create helper function `getStartButtonState(feature, isAnalyzing)`:
   - Returns { disabled: boolean, tooltip: string }
   - If creating_worktree: { disabled: true, tooltip: "Setting up worktree..." }
   - If investigating: { disabled: true, tooltip: "PM agent investigating codebase..." }
   - If questioning: { disabled: true, tooltip: "Answer PM agent questions first" }
   - If planning: { disabled: true, tooltip: "PM agent creating tasks..." }
   - If analyzing: { disabled: true, tooltip: "Analyzing tasks..." }
   - Otherwise: { disabled: false, tooltip: "Start execution" }

3. Add `title` attribute to Start button with the tooltip text.

4. Apply disabled styling:
   - Cursor: not-allowed
   - Opacity: 0.5
   - Prevent click handler when disabled
  </action>
  <verify>npm run typecheck passes, npm run build succeeds</verify>
  <done>Start button disabled with tooltip during planning phases</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run typecheck passes
- [ ] npm run build succeeds
- [ ] ExecutionControls shows state badge for investigating/questioning/planning/creating_worktree
- [ ] State badge hidden for non-planning states (ready, in_progress, etc.)
- [ ] Start button disabled with tooltip during planning phases
- [ ] Start button enabled for ready and in_progress states
</verification>

<success_criteria>

- All tasks completed
- Feature state badge displays correctly for planning phases
- Start button is context-aware with appropriate disabled states and tooltips
- No TypeScript errors or build failures
</success_criteria>

<output>
After completion, create `.planning/phases/v3.2-06-context-aware-ui-polish/v3.2-06-02-SUMMARY.md`
</output>
