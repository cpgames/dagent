---
phase: 14-git-branch-management
plan: 01
type: execute
---

<objective>
Add comprehensive git status monitoring to show branch state, uncommitted changes, and ahead/behind counts.

Purpose: Give users visibility into their working tree state directly in the status bar.
Output: Enhanced GitStatus component with dirty indicator and full status info.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior Phase:**
@.planning/phases/13-feature-chat/13-03-SUMMARY.md

**Existing Files:**
@src/main/git/git-manager.ts
@src/renderer/src/stores/git-store.ts
@src/renderer/src/components/Git/GitStatus.tsx
@src/renderer/src/components/Layout/StatusBar.tsx
@src/preload/index.d.ts

**Tech stack available:** electron-vite, Tailwind v4, Zustand, simple-git
**Established patterns:** IPC handler pattern, store-based state, preload bridge
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend git-store with full status state</name>
  <files>src/renderer/src/stores/git-store.ts</files>
  <action>
    Add new state fields to git-store:
    - `isDirty: boolean` - true if there are uncommitted changes
    - `staged: number` - count of staged files
    - `modified: number` - count of modified files
    - `untracked: number` - count of untracked files
    - `ahead: number` - commits ahead of remote
    - `behind: number` - commits behind remote

    Create new action `loadStatus()` that calls `window.electronAPI.git.getStatus()`
    and parses the StatusResult to populate these fields.

    The existing `loadBranch()` should also call `loadStatus()` to get full state.
    Keep the store interface backward compatible.
  </action>
  <verify>TypeScript compiles without errors: npm run typecheck</verify>
  <done>git-store has isDirty, staged, modified, untracked, ahead, behind state and loadStatus action</done>
</task>

<task type="auto">
  <name>Task 2: Update GitStatus component with status indicators</name>
  <files>src/renderer/src/components/Git/GitStatus.tsx</files>
  <action>
    Enhance GitStatus component to show:
    1. Current branch name (existing)
    2. Dirty indicator - small colored dot next to branch name:
       - Green dot if clean (no changes)
       - Yellow dot if dirty (has uncommitted changes)
    3. Counts badge - show (M:X U:Y) for modified/untracked if non-zero
    4. Ahead/behind arrows - ↑N ↓M if ahead/behind remote

    Layout: [branch-icon] main [dirty-dot] [↑2 ↓1] [M:3]

    Use Tailwind classes for styling. Keep the button clickable (for Phase 14-02).
    Add appropriate title tooltips explaining each indicator.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>GitStatus shows branch, dirty indicator, change counts, and ahead/behind</done>
</task>

<task type="auto">
  <name>Task 3: Add periodic status refresh</name>
  <files>src/renderer/src/components/Layout/StatusBar.tsx, src/renderer/src/stores/git-store.ts</files>
  <action>
    Add automatic status refresh:
    1. In StatusBar, set up an interval (every 30 seconds) to call git-store's loadStatus()
    2. Add a `refreshStatus()` action to git-store that only updates status (not branch)
    3. Also refresh when window regains focus (document.visibilitychange event)

    This ensures git status stays current as user works outside the app.
    Clean up intervals on unmount.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>Git status auto-refreshes every 30s and on window focus</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` succeeds without errors
- [ ] git-store has all new status fields
- [ ] GitStatus shows dirty indicator and change counts
- [ ] Status refreshes periodically
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Status bar shows complete git state information
- No TypeScript errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/14-git-branch-management/14-01-SUMMARY.md`
</output>
