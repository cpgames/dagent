---
phase: 32-agent-logs
plan: 02
type: execute
---

<objective>
Add log buttons to TaskNode and PM chat header, wire up log dialog.

Purpose: Allow users to view agent communications per task and for PM agent.
Output: Log button on each task node, log button in chat header, functional log dialogs.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.7-ROADMAP.md
@.planning/phases/32-agent-logs/32-01-SUMMARY.md
@src/renderer/src/components/DAG/TaskNode.tsx
@src/renderer/src/components/DAG/LogDialog.tsx
@src/renderer/src/components/Chat/ChatPanel.tsx
@src/renderer/src/views/DAGView.tsx
@src/renderer/src/stores/dialog-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add log button to TaskNode</name>
  <files>src/renderer/src/components/DAG/TaskNode.tsx</files>
  <action>
Add onLog callback to TaskNodeData interface.
Add log button in header between edit and delete buttons:
- Small icon button (document/log icon)
- onClick calls onLog(task.id)
- Title tooltip: "View agent logs for this task"
Follow existing edit/delete button styling pattern.
  </action>
  <verify>TypeScript compiles, button appears in TaskNode</verify>
  <done>TaskNode has log button that triggers onLog callback</done>
</task>

<task type="auto">
  <name>Task 2: Wire task log button in DAGView</name>
  <files>src/renderer/src/views/DAGView.tsx</files>
  <action>
Add handleLogTask callback:
- Takes taskId
- Calls openLogDialog with title "[Task Name] Logs", taskId, source='task'
- Pass to dagToNodes as onLog handler

Add LogDialog rendering:
- Import LogDialog from components/DAG
- Get logDialogOpen, logDialogTitle, logDialogTaskId, closeLogDialog from useDialogStore
- Load log entries filtered by taskId when dialog opens
- Render LogDialog when logDialogOpen is true

Load logs from storage when dialog opens (use existing loadHarnessLog IPC).
Filter entries by taskId if logDialogTaskId is set.
  </action>
  <verify>TypeScript compiles, clicking task log button opens LogDialog with filtered entries</verify>
  <done>Task log button opens dialog showing logs filtered to that task</done>
</task>

<task type="auto">
  <name>Task 3: Add PM log button to ChatPanel header</name>
  <files>src/renderer/src/components/Chat/ChatPanel.tsx, src/renderer/src/views/DAGView.tsx</files>
  <action>
ChatPanel: Add optional onShowLogs prop.
If provided, render log button next to Clear button in header:
- Small icon button (same log icon as TaskNode)
- onClick calls onShowLogs()
- Title: "View PM agent communication logs"

DAGView: Pass onShowLogs callback to FeatureChat:
- Calls openLogDialog with "PM Agent Logs", null taskId, source='pm'
- For PM logs, show chat messages converted to log entries OR store PM communications as logs

FeatureChat: Forward onShowLogs to ChatPanel.

For PM logs, use chat messages (messages from chat-store) - convert ChatMessage[] to LogEntry[] format for display in LogDialog.
  </action>
  <verify>TypeScript compiles, PM log button appears in chat header</verify>
  <done>PM chat header has log button, opens dialog with PM communications</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes
- [ ] Task nodes show log button
- [ ] Clicking task log button opens dialog with task-filtered logs
- [ ] PM chat header shows log button
- [ ] Clicking PM log button opens dialog with PM communications
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Phase 32 complete - agent logs visible for tasks and PM
</success_criteria>

<output>
After completion, create `.planning/phases/32-agent-logs/32-02-SUMMARY.md`
</output>
