---
phase: 47-kanban-feature-status
plan: 01
title: Feature Status from Task States
scope: medium
duration: ~10 min
tests: none
---

# Plan: Feature Status from Task States

## Objective

Automatically update feature status based on task states so Kanban columns reflect actual execution state.

Purpose: Users see features in correct column without manual status management
Output: Features automatically move between Not Started, In Progress, Needs Attention, and Completed columns

## Context

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/shared/types/feature.ts
@src/shared/types/task.ts
@src/main/dag-engine/orchestrator.ts
@src/renderer/src/stores/feature-store.ts
@src/renderer/src/views/KanbanView.tsx

**Status Rules (priority highest-to-lowest):**
1. Any task `failed` → `needs_attention`
2. All tasks `completed` → `completed`
3. Any task `dev`/`qa`/`merging` → `in_progress`
4. Default (all `blocked`/`ready`) → `not_started`

**Prior work:**
- Phase 42 added TaskStatus: blocked, ready, dev, qa, merging, completed, failed
- Feature type already has `status: FeatureStatus` field
- KanbanView groups features by `feature.status`

## Tasks

### Task 1: Create Feature Status Computation Utility

**Files:** `src/main/dag-engine/feature-status.ts`

**Action:**
1. Create new file `src/main/dag-engine/feature-status.ts`
2. Export function `computeFeatureStatus(tasks: Task[]): FeatureStatus`:
   - If any task has `status === 'failed'` → return `'needs_attention'`
   - If all tasks have `status === 'completed'` → return `'completed'`
   - If any task has `status === 'dev' || 'qa' || 'merging'` → return `'in_progress'`
   - Otherwise → return `'not_started'`
3. Handle edge case: empty tasks array → return `'not_started'`

**Verify:** File exists with exported function

**Done:**
- `computeFeatureStatus()` returns correct status per priority rules
- Handles edge cases (empty array, all blocked)

### Task 2: Trigger Status Updates from Orchestrator

**Files:** `src/main/dag-engine/orchestrator.ts`, `src/main/dag-engine/feature-status.ts`

**Action:**
1. Import `computeFeatureStatus` in orchestrator.ts
2. Create private method `updateFeatureStatus()`:
   - Get current graph tasks
   - Compute new status with `computeFeatureStatus(tasks)`
   - If status changed from current feature status:
     - Update feature in storage via `getFeatureStore().saveFeature()`
     - Emit event `feature_status_changed` with featureId and newStatus
3. Call `updateFeatureStatus()` after each state transition in:
   - `completeTaskCode()` (dev → qa)
   - `completeMerge()` (merging → completed)
   - `failTask()` (any → failed)
   - `handleQAResult()` (qa → merging or qa → dev)

**Verify:** `npm run build` succeeds

**Done:**
- Feature status updates automatically on task state changes
- Status persisted to storage

### Task 3: Wire Renderer to Receive Status Updates

**Files:** `src/main/ipc/execution-handlers.ts`, `src/renderer/src/stores/feature-store.ts`

**Action:**
1. In execution-handlers.ts, add IPC handler for `feature_status_changed` event:
   - Forward event to renderer via `mainWindow.webContents.send('feature:status-changed', { featureId, status })`
2. In preload (if needed), expose `onFeatureStatusChanged` listener
3. In feature-store.ts, subscribe to status changes on store creation:
   - Listen for `feature:status-changed` events
   - Call `updateFeature(featureId, { status })` to update local state

**Note:** This ensures Kanban view re-renders when feature status changes without manual refresh.

**Verify:**
- Start execution for a feature
- Observe feature moves from "Not Started" to "In Progress" in Kanban

**Done:**
- Kanban view updates in real-time as task states change
- Feature status persists across app restarts

## Verification

- [ ] `npm run build` succeeds without errors
- [ ] Feature with all blocked/ready tasks shows in "Not Started" column
- [ ] Feature with any dev/qa/merging task shows in "In Progress" column
- [ ] Feature with any failed task shows in "Needs Attention" column
- [ ] Feature with all completed tasks shows in "Completed" column
- [ ] Status changes persist to storage

## Success Criteria

- computeFeatureStatus() utility works with all task state combinations
- Orchestrator triggers status update on every task state transition
- Renderer receives and applies status updates in real-time
- Kanban columns reflect actual execution state

## Output

After completion, create `.planning/phases/47-kanban-feature-status/47-01-SUMMARY.md`
