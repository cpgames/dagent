---
phase: 46-dag-view-status-badges
plan: 01
title: Task State Badges with Tooltips
scope: low
duration: ~8 min
tests: none
---

# Plan: Task State Badges with Tooltips

## Objective

Add visual status badges to TaskNode that show the current execution state (DEV, QA, MERGE, FAILED) with tooltips displaying agent ID and duration.

Purpose: Users can see at a glance which tasks are being worked on and by which agent
Output: TaskNode shows dynamic status badges during execution

## Context

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/renderer/src/components/DAG/TaskNode.tsx

**Prior work:**
- Phase 28 added static agent type badges (Dev, QA, Merge) - these are DIFFERENT from state badges
- Phase 42 added TaskStatus type: blocked, ready, dev, qa, merging, completed, failed
- Task object has `status` field that changes during execution

**What already exists:**
- `statusBorderColors` and `statusBgColors` maps for all TaskStatus values
- Static agent badges section showing Dev/QA/Merge capabilities
- Status text at bottom showing `task.status`

**What we're adding:**
- Dynamic STATE badge (not static agent type badge)
- Only visible during active states (dev, qa, merging, failed)
- Tooltip with execution details

## Tasks

### Task 1: Replace Static Badges with Dynamic State Badge

**Files:** `src/renderer/src/components/DAG/TaskNode.tsx`

**Action:**
1. Remove the existing static "Agent badges" section (lines 131-153) that shows Dev/QA/Merge badges unconditionally
2. Add a new `StateBadge` component that renders based on `task.status`:
   - `dev` → Blue badge "DEV"
   - `qa` → Yellow badge "QA"
   - `merging` → Purple badge "MERGE"
   - `failed` → Red badge "FAILED"
   - Other states (blocked, ready, completed) → No badge (task is not actively being worked on)
3. Add tooltip showing:
   - State name
   - Agent ID (if available from task.assignedAgentId or similar - may need to add this field)
   - Duration since state started (if available)
4. Position badge prominently in header area, next to title

**Badge colors (matching v2.0 roadmap spec):**
```
dev     → bg-blue-500/20 text-blue-400
qa      → bg-yellow-500/20 text-yellow-400
merging → bg-purple-500/20 text-purple-400
failed  → bg-red-500/20 text-red-400
```

**Verify:** Visually confirm badge appears on tasks with dev/qa/merging/failed status

**Done:**
- Badge only shows for active states (dev, qa, merging, failed)
- Badge has correct color per state
- Tooltip displays on hover with state name

### Task 2: Add Execution Info to Tooltip

**Files:** `src/renderer/src/components/DAG/TaskNode.tsx`, `src/shared/types/dag.ts` (if needed)

**Action:**
1. Check if Task type already has execution info fields (`assignedAgentId`, `stateStartedAt`)
2. If not, no changes needed to types - tooltip will just show state name
3. Update tooltip to show:
   - State: "DEV" / "QA" / "MERGING" / "FAILED"
   - If agent ID available: "Agent: dev-task123"
   - If duration available: "Duration: 2m 30s"
4. Use native `title` attribute for simple implementation (no external tooltip library)

**Verify:** Hover over badge shows tooltip with available info

**Done:**
- Tooltip shows on badge hover
- Displays state name and any available execution metadata

## Verification

- [ ] `npm run build` succeeds without errors
- [ ] Tasks with `dev` status show blue "DEV" badge
- [ ] Tasks with `qa` status show yellow "QA" badge
- [ ] Tasks with `merging` status show purple "MERGE" badge
- [ ] Tasks with `failed` status show red "FAILED" badge
- [ ] Tasks with `blocked`/`ready`/`completed` status show NO badge
- [ ] Hover on badge shows tooltip

## Success Criteria

- Dynamic state badges replace static agent badges
- Badges visible only during active execution states
- Tooltip provides state context on hover
- Visual design matches v2.0 roadmap color spec

## Output

After completion, create `.planning/phases/46-dag-view-status-badges/46-01-SUMMARY.md`
