---
wave: 1
autonomous: true
---

# Plan 85-01: Horizon Glow Layer

## Objective

Create HorizonGlowLayer that renders a pulsing radial gradient glow at the horizon line.

## Success Criteria (from ROADMAP)

1. Horizon glow renders as radial gradient at 60-70% viewport height
2. Glow pulses between 0.3-0.8 intensity with sinusoidal animation
3. Pink/magenta colors match synthwave palette
4. Glow renders below grid but above starfield

## Tasks

### Task 1: Create HorizonGlowLayer class

Create `src/renderer/src/components/Background/layers/HorizonGlowLayer.ts`

**Implementation:**

```typescript
import type { Layer, LayerContext } from './types';

/**
 * HorizonGlowLayer renders a pulsing radial gradient glow at the horizon.
 *
 * Features:
 * - Radial gradient centered at horizon (65% from top)
 * - Height spans 30% of canvas (from 50% to 80% vertically)
 * - Sinusoidal pulsing between intensity 0.3 and 0.8
 * - Hot pink/magenta color (#ff2975)
 * - Uses 'lighter' blend mode for glow intensity
 */
export class HorizonGlowLayer implements Layer {
  private time = 0;

  // Configuration
  private readonly color = '#ff2975';
  private readonly positionY = 0.65; // 65% from top (horizon line)
  private readonly heightFraction = 0.3; // Glow spans 30% of canvas height
  private readonly minIntensity = 0.3;
  private readonly maxIntensity = 0.8;
  private readonly pulseSpeed = 0.001; // radians/ms for smooth pulsing

  init(_ctx: CanvasRenderingContext2D, _context: LayerContext): void {
    // No initialization needed - gradient computed each frame
  }

  update(deltaTime: number): void {
    this.time += deltaTime;
  }

  render(ctx: CanvasRenderingContext2D, context: LayerContext): void {
    const { width, height } = context;

    // Calculate pulsing intensity using sinusoidal animation
    // sin returns [-1, 1], map to [0, 1], then scale to [minIntensity, maxIntensity]
    const pulse = Math.sin(this.time * this.pulseSpeed);
    const normalizedPulse = (pulse + 1) / 2; // [0, 1]
    const intensity = this.minIntensity + normalizedPulse * (this.maxIntensity - this.minIntensity);

    // Save context for blend mode
    ctx.save();
    ctx.globalCompositeOperation = 'lighter';

    // Radial gradient centered at horizon
    const centerX = width / 2;
    const centerY = height * this.positionY;
    const radiusX = width * 0.8; // Wide horizontal spread
    const radiusY = height * this.heightFraction;

    // Create radial gradient
    const gradient = ctx.createRadialGradient(
      centerX, centerY, 0,
      centerX, centerY, Math.max(radiusX, radiusY)
    );

    // Color stops with intensity-based alpha
    gradient.addColorStop(0, this.hexToRgba(this.color, intensity * 0.8));
    gradient.addColorStop(0.4, this.hexToRgba(this.color, intensity * 0.4));
    gradient.addColorStop(0.7, this.hexToRgba(this.color, intensity * 0.15));
    gradient.addColorStop(1, this.hexToRgba(this.color, 0));

    // Draw elliptical glow using scale transform
    ctx.translate(centerX, centerY);
    ctx.scale(radiusX / radiusY, 1);
    ctx.translate(-centerX, -centerY);

    ctx.fillStyle = gradient;
    ctx.fillRect(centerX - radiusY, centerY - radiusY, radiusY * 2, radiusY * 2);

    ctx.restore();
  }

  reset(): void {
    this.time = 0;
  }

  /**
   * Convert hex color to rgba string with specified alpha.
   */
  private hexToRgba(hex: string, alpha: number): string {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
  }
}
```

**Key design decisions:**
- Position at 65% from top (middle of 60-70% range from requirements)
- Glow spans 30% of canvas height for visible effect
- Uses `globalCompositeOperation: 'lighter'` for additive blending
- Elliptical glow via scale transform (wider than tall)
- Gradient fades from center to edges with multiple stops

**Acceptance criteria:**
- [ ] Class implements Layer interface (init, update, render, reset)
- [ ] Renders radial gradient at ~65% viewport height
- [ ] Pulse speed creates smooth ~6 second cycle (0.001 rad/ms)
- [ ] Intensity range is 0.3-0.8 as specified
- [ ] Uses '#ff2975' hot pink color

### Task 2: Update barrel export

Update `src/renderer/src/components/Background/layers/index.ts` to export HorizonGlowLayer.

**Change:**
```typescript
export { SkyLayer } from './SkyLayer';
export { StarsLayer } from './StarsLayer';
export { HorizonGlowLayer } from './HorizonGlowLayer';
export type { Layer, LayerContext } from './types';
```

**Acceptance criteria:**
- [ ] HorizonGlowLayer exported from barrel file
- [ ] Build succeeds without errors

## Verification

After implementation:
1. Run `npm run build` - must succeed
2. Visually verify glow renders at horizon line
3. Confirm pulsing animation is visible and smooth
4. Check 'lighter' blend mode produces glow effect (not solid color)

## Dependencies

- Phase 83: Layer interface and types (complete)
- Phase 84: SkyLayer and StarsLayer (complete) - glow renders above these

## Commits

1. `feat(85): add HorizonGlowLayer with pulsing radial gradient`
2. `feat(85): export HorizonGlowLayer from layers barrel`
