---
phase: 09-feature-creation
plan: 03
type: execute
---

<objective>
Connect "New Feature" button to creation flow with dialog and git worktree integration.

Purpose: Complete the feature creation user flow from button click to feature appearing in UI.
Output: Working end-to-end feature creation with git worktree setup.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./09-03-SUMMARY.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**Prior plans:**
@.planning/phases/09-feature-creation/09-01-SUMMARY.md
@.planning/phases/09-feature-creation/09-02-SUMMARY.md

**Key files:**
@src/renderer/src/App.tsx
@src/renderer/src/stores/feature-store.ts

**Patterns established:**
- Dialog state managed with useState in App.tsx
- Feature store has addFeature() for local state updates
- Git operations via window.electronAPI.git.*
- Toast notifications for success/error feedback
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add createFeature async action to feature store</name>
  <files>src/renderer/src/stores/feature-store.ts</files>
  <action>
Add a new async action `createFeature` to the feature store:

1. Add to interface:
   - createFeature: (name: string) => Promise<Feature | null>

2. Implementation:
   - Set loading state
   - Call window.electronAPI.storage.createFeature(name) to create feature record
   - Call window.electronAPI.git.createFeatureWorktree(feature.id) to create git worktree
   - If worktree creation fails, still keep the feature (worktree can be created later)
   - Add feature to local state using addFeature()
   - Show success toast: "Feature '{name}' created"
   - Clear loading state
   - Return created feature

3. Error handling:
   - Catch errors from storage.createFeature
   - Set error state and show error toast
   - Return null on failure
  </action>
  <verify>TypeScript compiles: `npm run typecheck`</verify>
  <done>createFeature action exists in store with git worktree integration</done>
</task>

<task type="auto">
  <name>Task 2: Wire up New Feature button and dialog in App.tsx</name>
  <files>src/renderer/src/App.tsx</files>
  <action>
Update App.tsx to complete the feature creation flow:

1. Import NewFeatureDialog from './components/Feature'

2. Add state:
   - const [newFeatureDialogOpen, setNewFeatureDialogOpen] = useState(false)

3. Get createFeature from useFeatureStore:
   - const { loadFeatures, createFeature } = useFeatureStore()

4. Create handler:
   ```typescript
   const handleCreateFeature = async (name: string) => {
     const feature = await createFeature(name)
     if (feature) {
       setNewFeatureDialogOpen(false)
     }
     // Error case is handled in store (toast displayed)
   }
   ```

5. Update "New Feature" button:
   - Add onClick={() => setNewFeatureDialogOpen(true)}

6. Add dialog component after AuthDialog:
   ```tsx
   <NewFeatureDialog
     isOpen={newFeatureDialogOpen}
     onClose={() => setNewFeatureDialogOpen(false)}
     onSubmit={handleCreateFeature}
   />
   ```
  </action>
  <verify>TypeScript compiles: `npm run typecheck`</verify>
  <done>Button opens dialog, dialog submits to store, feature appears in UI</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete feature creation flow from button to feature appearing in Kanban</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Click "+ New Feature" button in header
    3. Verify: Dialog opens with name input
    4. Enter feature name (e.g., "Test Feature")
    5. Click Create
    6. Verify: Success toast appears
    7. Verify: Feature appears in Kanban view under "Not Started" column
    8. Verify: .dagent-worktrees/feature-test-feature/ directory created (check file explorer)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes
- [ ] `npm run build` succeeds
- [ ] New Feature button has onClick handler
- [ ] Dialog opens on button click
- [ ] Feature creation persists to storage
- [ ] Git worktree created for new feature
- [ ] Feature appears in Kanban view
</verification>

<success_criteria>
- New Feature button opens dialog
- Dialog validates name input
- Feature created with proper ID and branch name
- Git worktree created
- Feature appears in UI immediately
- Success/error toasts displayed
- Phase 9 complete
</success_criteria>

<output>
After completion, create `.planning/phases/09-feature-creation/09-03-SUMMARY.md`
</output>
