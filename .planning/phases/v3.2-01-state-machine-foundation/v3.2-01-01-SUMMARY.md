# Plan v3.2-01-01 Summary

## Overview

**Phase:** v3.2-01-state-machine-foundation
**Plan:** 01 - Core Type System Update
**Status:** Complete
**Execution Time:** ~5 min

## Objective

Update the core type system to support the new 9-state feature lifecycle, establishing the type foundation for features that start without worktrees and progress through explicit planning phases.

## Tasks Completed

### Task 1: Update FeatureStatus type to 9 states
- **File:** `src/shared/types/feature.ts`
- **Change:** Updated FeatureStatus union from 6 states to 9 states
- **Old:** `'planning' | 'backlog' | 'in_progress' | 'needs_attention' | 'completed' | 'archived'`
- **New:** `'not_started' | 'creating_worktree' | 'investigating' | 'questioning' | 'planning' | 'ready' | 'in_progress' | 'completed' | 'archived'`
- **Commit:** `69050f8`

### Task 2: Update VALID_TRANSITIONS map for 9-state machine
- **File:** `src/main/services/feature-status-manager.ts`
- **Changes:**
  - Updated VALID_TRANSITIONS with 9-state transition rules
  - Updated JSDoc documentation for 9-state workflow
  - Updated migrateExistingFeatures() to handle old statuses:
    - `backlog` -> `ready`
    - `needs_attention` -> `ready`
  - Updated recoverStuckPlanningFeatures() to use `ready` instead of `backlog`
- **Commit:** `68cca31`

### Task 3: Update StatusBadge component for 9 states
- **File:** `src/renderer/src/components/StatusBadge/StatusBadge.tsx`
- **Changes:**
  - Added badge configs for new states:
    - `not_started`: Gray/neutral, label "Not Started"
    - `creating_worktree`: Amber with pulse, label "Creating..."
    - `investigating`: Purple with pulse, label "Investigating"
    - `questioning`: Cyan with pulse, label "Questions"
    - `ready`: Green, label "Ready"
  - Removed configs for: `backlog`, `needs_attention`
  - Added pulse animation for in-progress states
- **Commit:** `612e0d4`

## Verification Results

- [x] FeatureStatus type has exactly 9 states
- [x] VALID_TRANSITIONS maps all 9 states to valid next states
- [x] StatusBadge has configs for all 9 states
- [x] TypeScript shows expected errors in other files (Plan 02 scope)

## Files Modified

| File | Lines Changed | Purpose |
|------|--------------|---------|
| `src/shared/types/feature.ts` | +1/-1 | FeatureStatus type |
| `src/main/services/feature-status-manager.ts` | +68/-34 | Transition map & migration |
| `src/renderer/src/components/StatusBadge/StatusBadge.tsx` | +9/-5 | Badge configs |

## Key Decisions

1. **State naming:** Used `not_started` over `draft` to clearly indicate no work has begun
2. **Removed states:** `needs_attention` removed entirely (was used for error recovery, now handled differently)
3. **State replacement:** `backlog` replaced by `ready` to better reflect "tasks are ready for execution"
4. **Migration strategy:** Old `backlog` and `needs_attention` both migrate to `ready` as best-effort recovery

## Type Errors to Address in Plan 02

The following files have type errors due to referencing old statuses:
- `src/main/agent/pm-agent-manager.ts`
- `src/main/dag-engine/feature-status.ts`
- `src/main/ipc/feature-handlers.ts`
- `src/renderer/src/components/DAG/LayoutControls.tsx`
- `src/renderer/src/components/Feature/FeatureDescription.tsx`
- `src/renderer/src/components/Kanban/FeatureCard.tsx`
- `src/renderer/src/stores/chat-store.ts`
- `src/renderer/src/views/KanbanView.tsx`

## Next Steps

Proceed to Plan v3.2-01-02 to update all remaining files that reference old status values.
