---
phase: v3.2-01-state-machine-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/shared/types/feature.ts
  - src/main/services/feature-status-manager.ts
  - src/renderer/src/components/StatusBadge/StatusBadge.tsx
autonomous: true

must_haves:
  truths:
    - "FeatureStatus type includes all 9 states"
    - "VALID_TRANSITIONS map covers all 9 states with valid transition rules"
    - "StatusBadge can render all 9 status states"
  artifacts:
    - path: "src/shared/types/feature.ts"
      provides: "FeatureStatus type with 9 states"
      contains: "not_started"
    - path: "src/main/services/feature-status-manager.ts"
      provides: "VALID_TRANSITIONS with 9-state transition map"
      contains: "creating_worktree"
    - path: "src/renderer/src/components/StatusBadge/StatusBadge.tsx"
      provides: "Badge configs for all 9 states"
      contains: "not_started"
  key_links:
    - from: "src/shared/types/feature.ts"
      to: "src/main/services/feature-status-manager.ts"
      via: "FeatureStatus type import"
      pattern: "import.*FeatureStatus.*feature"
    - from: "src/main/services/feature-status-manager.ts"
      to: "VALID_TRANSITIONS object"
      via: "transition lookup in validateTransition"
      pattern: "VALID_TRANSITIONS\\[from\\]"
---

<objective>
Update the core type system to support the new 9-state feature lifecycle.

Purpose: Establish the type foundation for features that start without worktrees and progress through explicit planning phases.

Output: Updated FeatureStatus type, validated transition map, and StatusBadge support for all states.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md

# Source files to modify:
@src/shared/types/feature.ts
@src/main/services/feature-status-manager.ts
@src/renderer/src/components/StatusBadge/StatusBadge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update FeatureStatus type to 9 states</name>
  <files>src/shared/types/feature.ts</files>
  <action>
    Update the FeatureStatus type union from the current 6 states to the new 9-state lifecycle:

    Old: `'planning' | 'backlog' | 'in_progress' | 'needs_attention' | 'completed' | 'archived'`

    New: `'not_started' | 'creating_worktree' | 'investigating' | 'questioning' | 'planning' | 'ready' | 'in_progress' | 'completed' | 'archived'`

    Note the mapping:
    - `not_started`: NEW - feature exists but no worktree yet
    - `creating_worktree`: NEW - worktree creation in progress
    - `investigating`: NEW - PM agent exploring codebase
    - `questioning`: NEW - PM agent asking user questions
    - `planning`: KEPT - PM agent creating tasks
    - `ready`: NEW - replaces 'backlog', tasks ready for execution
    - `in_progress`: KEPT - execution running
    - `completed`: KEPT - all tasks done
    - `archived`: KEPT - feature merged/closed

    REMOVED: `backlog` (replaced by `ready`), `needs_attention` (removed entirely per requirements)

    DO NOT modify any other types in this file. Only change the FeatureStatus union.
  </action>
  <verify>npm run typecheck:node -- shows type errors in files expecting old statuses (expected - will fix in later tasks)</verify>
  <done>FeatureStatus type contains exactly 9 states in the correct order</done>
</task>

<task type="auto">
  <name>Task 2: Update VALID_TRANSITIONS map for 9-state machine</name>
  <files>src/main/services/feature-status-manager.ts</files>
  <action>
    Update the VALID_TRANSITIONS constant to implement the new 9-state machine:

    ```typescript
    const VALID_TRANSITIONS: Record<FeatureStatus, FeatureStatus[]> = {
      not_started: ['creating_worktree'],  // Start triggers worktree creation
      creating_worktree: ['investigating'],  // Worktree ready -> PM investigates
      investigating: ['questioning'],  // Investigation done -> ask questions
      questioning: ['planning'],  // Questions answered -> create tasks
      planning: ['ready'],  // Tasks created -> ready for execution
      ready: ['in_progress', 'planning'],  // Start execution or re-plan
      in_progress: ['completed', 'ready'],  // Finish or pause back to ready
      completed: ['archived'],  // Archive after merge
      archived: ['completed']  // Can un-archive if needed
    }
    ```

    Also update:
    1. The JSDoc comment at the top describing the status workflow
    2. The class-level docstring to reflect the new 9-state machine
    3. Update migrateExistingFeatures() to handle migration from old statuses:
       - 'backlog' -> 'ready'
       - 'needs_attention' -> 'ready' (best effort recovery)
       - Keep existing migration from 'not_started' -> but now it stays as 'not_started'

    DO NOT change the validateTransition() method signature. DO NOT change updateFeatureStatus() method signature. Only update the VALID_TRANSITIONS map and related comments/migration logic.
  </action>
  <verify>npm run typecheck:node completes (may have warnings, should not have errors in this file)</verify>
  <done>VALID_TRANSITIONS covers all 9 states with correct transition rules, migration handles old statuses</done>
</task>

<task type="auto">
  <name>Task 3: Update StatusBadge component for 9 states</name>
  <files>src/renderer/src/components/StatusBadge/StatusBadge.tsx</files>
  <action>
    Add badge configurations for the new states. The StatusBadge component likely has a config object mapping status -> {color, label, icon}.

    Add configs for:
    - `not_started`: Gray/neutral color, label "Not Started"
    - `creating_worktree`: Yellow/amber color, label "Creating...", optional spinner icon
    - `investigating`: Purple color (matches existing analysis theme), label "Investigating"
    - `questioning`: Blue color, label "Questions", question mark icon if available
    - `ready`: Green color (similar to old backlog ready state), label "Ready"

    Keep existing configs for: `planning`, `in_progress`, `completed`, `archived`

    Remove configs for: `backlog` (replaced by ready), `needs_attention` (removed)

    Use the existing color palette conventions in the component. Match the synthwave theme (purple, cyan, pink, etc.) where appropriate.
  </action>
  <verify>npm run typecheck:web completes without errors in StatusBadge.tsx</verify>
  <done>StatusBadge has badge configs for all 9 states with appropriate colors and labels</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] FeatureStatus type has exactly 9 states: not_started, creating_worktree, investigating, questioning, planning, ready, in_progress, completed, archived
- [ ] VALID_TRANSITIONS maps all 9 states to their valid next states
- [ ] StatusBadge has configs for all 9 states
- [ ] npm run typecheck shows which other files need updates (expected - addressed in Plan 02)
</verification>

<success_criteria>
- All tasks completed
- Core type system supports 9-state lifecycle
- No type errors in the three modified files
- TypeScript compilation identifies remaining files to update (handled in Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/v3.2-01-state-machine-foundation/v3.2-01-01-SUMMARY.md`
</output>
