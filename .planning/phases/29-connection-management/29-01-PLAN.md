# Plan: Connection Management

**Phase:** 29-connection-management
**Plan:** 01
**Feature:** Select and delete connections between tasks in DAG view

## Context

Phase 29 of v1.5 adds edge selection and deletion to the DAG view. Users need to be able to click on edges to select them, see visual feedback, and delete unwanted connections with confirmation.

**Current state:**
- DAGView uses React Flow with custom TaskNode nodes
- Edges are created via `dagToEdges()` function with basic styling
- `removeConnection(from, to)` already exists in DAG store
- `handleEdgesChange` handles edge removal events

**Required changes:**
- Add edge selection state management
- Create custom edge component with delete button
- Add confirmation dialog before deletion
- Wire up to existing removeConnection store method

## References

- `src/renderer/src/views/DAGView.tsx` - Main DAG view with edge handling
- `src/renderer/src/stores/dag-store.ts` - removeConnection method
- `src/renderer/src/components/DAG/index.ts` - DAG component exports

## Tasks

### Task 1: Add custom edge component with selection state

Create a SelectableEdge component that:
- Renders the edge path with selectable hit area
- Shows highlight styling when selected (different color, thicker stroke)
- Displays delete button at edge center when selected
- Uses React Flow's EdgeProps pattern

**Files:**
- Create: `src/renderer/src/components/DAG/SelectableEdge.tsx`
- Modify: `src/renderer/src/components/DAG/index.ts` (export)
- Modify: `src/renderer/src/views/DAGView.tsx` (register edgeTypes, selected state)

**Implementation:**
1. Create SelectableEdge component using `getBezierPath` from React Flow
2. Add `selectedEdgeId` state to DAGView
3. Register `edgeTypes = { selectable: SelectableEdge }`
4. Update `dagToEdges` to set `type: 'selectable'` and pass selection handlers
5. Add `onEdgeClick` handler to ReactFlow to set selection
6. Click away (on pane) clears selection

**Verification:**
- Click on edge selects it (visual highlight)
- Click on different edge changes selection
- Click on canvas background clears selection
- Delete button visible at edge center when selected

### Task 2: Add delete confirmation and wire up removal

Add confirmation dialog before edge deletion:
- Confirm dialog warns about removing dependency
- On confirm, call removeConnection and clear selection
- On cancel, keep selection

**Files:**
- Modify: `src/renderer/src/components/DAG/SelectableEdge.tsx` (add confirm state)
- Modify: `src/renderer/src/views/DAGView.tsx` (pass removeConnection to edges)

**Implementation:**
1. Add local `showConfirm` state to SelectableEdge
2. Delete button click shows confirm dialog (inline or modal)
3. Confirm button calls `onDelete(source, target)` passed via edge data
4. Cancel hides dialog, keeps selection
5. After deletion, edge disappears naturally via store update

**Verification:**
- Click delete button shows confirmation
- Cancel keeps edge and selection
- Confirm removes edge from graph
- DAG store updated correctly
- Build passes with no errors

## Acceptance Criteria

- [ ] Edges can be clicked to select them
- [ ] Selected edge has distinct visual styling (highlight color)
- [ ] Delete button appears at center of selected edge
- [ ] Clicking delete shows confirmation dialog
- [ ] Confirming deletion removes the connection
- [ ] Canceling keeps the connection intact
- [ ] Selection clears when clicking elsewhere
- [ ] Build passes with no TypeScript errors

## Estimated Scope

- 2 tasks
- ~120 lines new code
- ~10 min execution time
