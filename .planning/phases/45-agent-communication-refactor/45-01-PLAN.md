---
phase: 45-agent-communication-refactor
plan: 01
title: Simplify Agent Communication
scope: low
duration: ~8 min
tests: none
---

# Plan: Simplify Agent Communication

## Context

Phase 44 implemented QA Agent but it still uses harness communication pattern unnecessarily. The v2.0 roadmap specifies a cleaner communication model:

| Agent | Talks to Harness? | Why |
|-------|-------------------|-----|
| Dev | Yes | Intention approval workflow |
| QA | No | Autonomous with full context |
| Merge | No | Mechanical operation |
| PM | Yes | Human interaction channel |

Currently:
- **TaskAgent**: Uses MessageBus to communicate with harness ✓ (correct)
- **QAAgent**: Doesn't use MessageBus ✓ (correct - already autonomous)
- **MergeAgent**: Calls `getHarnessAgent()` directly for notifications ✗ (should be autonomous)

The main simplification needed is removing harness notifications from MergeAgent.

## Tasks

### Task 1: Remove Harness Notifications from MergeAgent

MergeAgent currently calls harness directly for:
1. `markTaskMerging()` - in `initialize()`
2. `completeTask()` - in `executeMerge()` success
3. `failTask()` - in `executeMerge()` failure

These are redundant because:
- Orchestrator already knows the task is merging (it spawned the merge agent)
- Orchestrator handles the merge result and updates task status directly
- Status updates go through TaskPoolManager, not harness

**Changes to `src/main/agents/merge-agent.ts`:**
- Remove `getHarnessAgent` import
- Remove harness notification calls from `initialize()`, `executeMerge()`
- Keep event emissions for orchestrator to subscribe to

### Task 2: Verify Orchestrator Handles Merge Results

Check that orchestrator properly handles merge completion/failure without relying on harness notifications. The orchestrator's `executeMerge()` call already handles:
- Transitioning task merging → completed on success
- Transitioning task merging → failed on failure
- Cascading blocked → ready for dependents

### Task 3: Update Harness Status Tracking (Optional Cleanup)

The harness `markTaskMerging`, `completeTask`, `failTask` methods are now only used by direct orchestrator calls (for logging purposes). Consider if these should be removed or kept for visibility.

**Decision:** Keep them for now - they provide useful logging. The harness is still the coordination point for task execution state visibility.

## Verification

- [ ] `npm run build` succeeds without errors
- [ ] MergeAgent no longer imports or calls HarnessAgent
- [ ] MergeAgent still emits events for orchestrator
- [ ] Merge operation works end-to-end (task dev → qa → merging → completed)

## Scope Assessment

**Low complexity** - This is primarily a removal task:
- Remove 3 harness calls from MergeAgent
- No new functionality needed
- QAAgent already follows the autonomous pattern

## Files to Modify

1. `src/main/agents/merge-agent.ts` - Remove harness imports and calls
