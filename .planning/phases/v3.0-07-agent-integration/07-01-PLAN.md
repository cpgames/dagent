---
phase: v3.0-07-agent-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/agents/qa-agent.ts
  - src/main/agents/qa-types.ts
autonomous: true
must_haves:
  truths:
    - "QA agent logs reviews to SessionManager when sessionId is provided"
    - "QA review results are saved to checkpoint summary"
    - "QA sessions link to task in qa state"
  artifacts:
    - path: "src/main/agents/qa-agent.ts"
      provides: "SessionManager integration for QA agent"
      contains: "getSessionManager"
    - path: "src/main/agents/qa-types.ts"
      provides: "sessionId field in QA agent state"
      contains: "sessionId"
  key_links:
    - from: "qa-agent.ts"
      to: "session-manager.ts"
      via: "getSessionManager().addMessage()"
      pattern: "getSessionManager"
---

<objective>
Integrate QA Agent with SessionManager for session logging.

Purpose: QA agent logs review activities to SessionManager, enabling checkpoint compaction and review history tracking.
Output: QA agent with sessionId support and SessionManager logging.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v3.0-session-checkpoint-ROADMAP.md
@.planning/phases/v3.0-05-dev-agent-integration/05-02-SUMMARY.md

@src/main/agents/qa-agent.ts
@src/main/agents/qa-types.ts
@src/main/agents/dev-agent.ts (for SessionManager integration pattern)
@src/main/services/session-manager.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sessionId to QA agent types</name>
  <files>src/main/agents/qa-types.ts</files>
  <action>
    Add sessionId field to QAAgentState interface:

    ```typescript
    export interface QAAgentState {
      // ... existing fields ...
      sessionId: string | null  // Session ID for SessionManager logging
    }
    ```

    Update DEFAULT_QA_AGENT_STATE to include:
    ```typescript
    sessionId: null
    ```
  </action>
  <verify>npm run build succeeds, TypeScript compiles</verify>
  <done>QAAgentState has sessionId field</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SessionManager into QA Agent</name>
  <files>src/main/agents/qa-agent.ts</files>
  <action>
    1. Import getSessionManager:
       ```typescript
       import { getSessionManager } from '../services/session-manager'
       ```

    2. Add logToSessionManager helper method (follow DevAgent pattern):
       ```typescript
       private async logToSessionManager(
         role: 'user' | 'assistant',
         content: string,
         metadata?: Record<string, unknown>
       ): Promise<void> {
         if (!this.state.sessionId) {
           // No session - skip logging
           return
         }
         try {
           const sessionManager = getSessionManager()
           await sessionManager.addMessage(
             this.state.sessionId,
             role,
             content,
             metadata
           )
         } catch (error) {
           console.error('[QAAgent] Failed to log to session:', error)
         }
       }
       ```

    3. Update execute() method to log:
       - At start: Log "Starting QA review for task: {taskTitle}"
       - On review complete (passed): Log "QA review PASSED" with files reviewed
       - On review complete (failed): Log "QA review FAILED" with feedback
       - On commit: Log "Changes committed: {commitHash}"
       - On error: Log error message

    4. Add method to set sessionId (for orchestrator to provide):
       ```typescript
       setSessionId(sessionId: string): void {
         this.state.sessionId = sessionId
       }
       ```
  </action>
  <verify>npm run build succeeds, QA agent compiles with SessionManager integration</verify>
  <done>QA agent logs review activities to SessionManager when sessionId is set</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] QAAgentState has sessionId field
- [ ] QAAgent imports getSessionManager
- [ ] QAAgent has logToSessionManager helper method
- [ ] execute() logs review start, result, and any errors
- [ ] setSessionId() method exists
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- QA agent follows same SessionManager pattern as DevAgent
</success_criteria>

<output>
After completion, create `.planning/phases/v3.0-07-agent-integration/07-01-SUMMARY.md`
</output>
