---
phase: 12-project-selection
plan: 02
type: execute
---

<objective>
Create new project wizard for initializing a new DAGent project with folder creation and .dagent setup.

Purpose: Allow users to create new projects from scratch with proper .dagent directory initialization.
Output: NewProjectDialog component, project creation IPC handler, folder + .dagent init logic.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./12-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-project-selection/12-01-SUMMARY.md

@src/main/ipc/project-handlers.ts
@src/main/storage/paths.ts
@src/preload/index.ts
@src/renderer/src/stores/project-store.ts
@src/renderer/src/components/Project/ProjectSelectionDialog.tsx

**Tech stack available:** Electron dialog API, Node fs, Zustand
**Established patterns:** Dialog component pattern, IPC handlers, .dagent directory structure
**Constraining decisions:**
- .dagent/worktrees/ is where features are stored (from paths.ts)
- Git init optional (user might add to existing repo later)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add project creation IPC handlers</name>
  <files>src/main/ipc/project-handlers.ts, src/main/storage/paths.ts</files>
  <action>
Add to project-handlers.ts:
- `project:create` handler that accepts { parentPath: string, projectName: string }:
  1. Construct full path: path.join(parentPath, projectName)
  2. Check if directory already exists - return error if so
  3. Create directory with fs.mkdir
  4. Create .dagent directory inside
  5. Create .dagent/worktrees directory (empty, for features)
  6. Call initializeStorage, setHistoryProjectRoot, gitManager.initialize
  7. Return { success: true, projectPath } or { success: false, error }

- `project:select-parent-dialog` handler:
  1. Use dialog.showOpenDialog with ['openDirectory']
  2. Return selected path or null

Add to paths.ts:
- Export getDagentRoot(projectRoot) function: returns path.join(projectRoot, '.dagent')
- Export ensureDagentStructure(projectRoot) function: creates .dagent and .dagent/worktrees if not exist
  </action>
  <verify>Build succeeds: npm run build</verify>
  <done>project:create handler creates folder + .dagent structure, project:select-parent-dialog opens folder picker</done>
</task>

<task type="auto">
  <name>Task 2: Add project creation to preload API</name>
  <files>src/preload/index.ts</files>
  <action>
Add to project namespace in electronAPI:
```typescript
create: (parentPath: string, projectName: string): Promise<{ success: boolean; projectPath?: string; error?: string }> =>
  ipcRenderer.invoke('project:create', { parentPath, projectName }),
selectParentDialog: (): Promise<string | null> =>
  ipcRenderer.invoke('project:select-parent-dialog')
```
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>project.create and project.selectParentDialog exposed to renderer</done>
</task>

<task type="auto">
  <name>Task 3: Create NewProjectDialog component</name>
  <files>src/renderer/src/components/Project/NewProjectDialog.tsx, src/renderer/src/components/Project/index.ts, src/renderer/src/stores/project-store.ts</files>
  <action>
1. Create NewProjectDialog.tsx:
   - Props: isOpen, onClose, onSuccess(projectPath: string)
   - State: parentPath (string), projectName (string), isSubmitting, error
   - Form layout:
     - Location field: read-only input showing parentPath + Browse button
     - Project Name field: text input with validation (not empty, valid folder name)
   - Browse button calls electronAPI.project.selectParentDialog, sets parentPath
   - Submit: validate name, call electronAPI.project.create, onSuccess on success
   - Same dialog styling as NewFeatureDialog
   - Validation: name required, no special characters except - and _, must not start with .

2. Update project-store.ts:
   - Add createProject(parentPath, name) action that calls IPC and updates projectPath on success

3. Update Project/index.ts to export NewProjectDialog
  </action>
  <verify>npm run build succeeds</verify>
  <done>NewProjectDialog with location picker and project name input, creates project on submit</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] project:create IPC handler creates folder structure
- [ ] NewProjectDialog renders with location picker and name input
- [ ] Creating project initializes storage and git
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- NewProjectDialog creates folder with .dagent structure
- New project is opened after creation
</success_criteria>

<output>
After completion, create `.planning/phases/12-project-selection/12-02-SUMMARY.md`
</output>
