---
phase: 12-project-selection
plan: 01
type: execute
---

<objective>
Create the project selection dialog and backend infrastructure for opening folders and switching projects.

Purpose: Enable users to open different projects from the UI rather than relying on cwd at startup.
Output: ProjectSelectionDialog component, project IPC handlers, project-store for renderer state.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./12-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-layout-restructure/11-03-SUMMARY.md

@src/main/index.ts
@src/main/ipc/storage-handlers.ts
@src/preload/index.ts
@src/renderer/src/App.tsx
@src/renderer/src/components/Feature/NewFeatureDialog.tsx

**Tech stack available:** Electron dialog API, Zustand, Tailwind
**Established patterns:** Dialog component pattern (NewFeatureDialog), IPC handler pattern, Zustand stores
**Constraining decisions:**
- Storage requires initializeStorage(projectRoot) before use
- Git manager requires initialize(projectRoot) before use
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project IPC handlers</name>
  <files>src/main/ipc/project-handlers.ts, src/main/ipc/handlers.ts</files>
  <action>
Create project-handlers.ts with IPC handlers for:
- `project:open-dialog` - Use Electron dialog.showOpenDialog with properties ['openDirectory'], return selected path or null
- `project:set-project` - Accept projectRoot string, call initializeStorage(), setHistoryProjectRoot(), gitManager.initialize(), return success/error
- `project:get-current` - Return current project root path

Import and register in handlers.ts. Use BrowserWindow.getFocusedWindow() as parent for dialog.

Store current project path in module-level variable. Export getter function for other modules.
  </action>
  <verify>Build succeeds: npm run build</verify>
  <done>IPC handlers registered, project:open-dialog shows native folder picker, project:set-project reinitializes storage/git</done>
</task>

<task type="auto">
  <name>Task 2: Add project API to preload</name>
  <files>src/preload/index.ts</files>
  <action>
Add project namespace to electronAPI:
```typescript
project: {
  openDialog: (): Promise<string | null> => ipcRenderer.invoke('project:open-dialog'),
  setProject: (path: string): Promise<{ success: boolean; error?: string }> => ipcRenderer.invoke('project:set-project', path),
  getCurrent: (): Promise<string> => ipcRenderer.invoke('project:get-current')
}
```

Place after the auth namespace.
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>project API exposed to renderer with openDialog, setProject, getCurrent methods</done>
</task>

<task type="auto">
  <name>Task 3: Create project-store and ProjectSelectionDialog</name>
  <files>src/renderer/src/stores/project-store.ts, src/renderer/src/stores/index.ts, src/renderer/src/components/Project/ProjectSelectionDialog.tsx, src/renderer/src/components/Project/index.ts</files>
  <action>
1. Create project-store.ts (Zustand):
   - State: projectPath (string | null), isLoading, error
   - Actions: loadCurrentProject(), openProject(path: string), openFolderDialog()
   - openFolderDialog calls electronAPI.project.openDialog, then openProject on result
   - openProject calls electronAPI.project.setProject, updates state, clears feature store

2. Export from stores/index.ts

3. Create ProjectSelectionDialog component:
   - Props: isOpen, onClose
   - Two main buttons: "Open Folder" (folder icon), "Create New Project" (plus icon)
   - "Open Folder" calls openFolderDialog from store, closes on success
   - "Create New Project" button - placeholder onClick for now (12-02 will implement)
   - Use same dialog pattern as NewFeatureDialog (backdrop, rounded panel, close button)
   - Show loading spinner when isLoading, error message if error

4. Create Project/index.ts with export
  </action>
  <verify>npm run build succeeds</verify>
  <done>project-store with openProject/openFolderDialog actions, ProjectSelectionDialog with Open Folder button that triggers native folder picker</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] IPC handlers registered and callable
- [ ] project-store created with actions
- [ ] ProjectSelectionDialog renders with Open Folder button
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Project selection dialog can open native folder picker
- Selecting folder reinitializes storage and git for new project
</success_criteria>

<output>
After completion, create `.planning/phases/12-project-selection/12-01-SUMMARY.md`
</output>
