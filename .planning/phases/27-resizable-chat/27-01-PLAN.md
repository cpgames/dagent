---
phase: 27-resizable-chat
plan: 01
type: execute
---

<objective>
Make the Feature Chat panel (and Task Chat overlay) resizable by dragging the left edge.

Purpose: Allow users to adjust chat panel width for their preferences and screen sizes.
Output: Draggable resize handle, persisted width preference, smooth interaction.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/v1.5-ROADMAP.md
@.planning/STATE.md

@src/renderer/src/views/DAGView.tsx
@src/renderer/src/components/Chat/FeatureChat.tsx
@src/renderer/src/components/Chat/ChatPanel.tsx

**Existing structure:**
- DAGView has `<div className="relative w-80">` wrapping FeatureChat (line 289)
- FeatureChat is a thin wrapper around ChatPanel with `h-full`
- TaskChat overlay sits on top of FeatureChat in same container

**Decisions:**
- Width state and resize logic should live in DAGView (parent of chat panels)
- Use localStorage for persistence (no store needed for simple preference)
- Min width: 280px (readable chat), Max width: 600px (not too wide)
- Default: 320px (current w-80)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ResizeHandle component</name>
  <files>src/renderer/src/components/Layout/ResizeHandle.tsx, src/renderer/src/components/Layout/index.ts</files>
  <action>
Create a reusable ResizeHandle component:

**Props:**
- `onResize: (deltaX: number) => void` - called during drag with horizontal delta
- `onResizeEnd?: () => void` - called when drag ends (for persistence)
- `position?: 'left' | 'right'` - which edge (default 'left')

**Implementation:**
- Render 4px wide div with cursor-col-resize
- On mousedown: add document listeners for mousemove/mouseup
- On mousemove: call onResize with (event.movementX)
- On mouseup: cleanup listeners, call onResizeEnd
- Style: transparent with hover state (gray-500/50 on hover)
- Position absolute on the specified edge

**Export from Layout/index.ts**
  </action>
  <verify>TypeScript compiles, component exports correctly</verify>
  <done>ResizeHandle component created with drag-to-resize logic</done>
</task>

<task type="auto">
  <name>Task 2: Add resize state and persistence to DAGView</name>
  <files>src/renderer/src/views/DAGView.tsx</files>
  <action>
Add chat panel resizing to DAGView:

**State:**
- `const [chatWidth, setChatWidth] = useState(() => {
    const saved = localStorage.getItem('dagent.chatPanelWidth')
    return saved ? parseInt(saved, 10) : 320
  })`

**Resize handlers:**
- `handleChatResize(deltaX)`: Update width with constraints
  - For left-edge resize: `setChatWidth(w => Math.min(600, Math.max(280, w - deltaX)))`
  - Note: negative deltaX (drag right) = smaller, positive (drag left) = larger
- `handleChatResizeEnd()`: Persist to localStorage
  - `localStorage.setItem('dagent.chatPanelWidth', chatWidth.toString())`

**Update render:**
- Replace `w-80` with inline style: `style={{ width: chatWidth }}`
- Add ResizeHandle component as first child of the chat container div
- Import ResizeHandle from Layout

**Min/max:** 280px minimum (readable), 600px maximum (not too wide)
  </action>
  <verify>Build passes, chat panel renders with dynamic width</verify>
  <done>Chat panel width is dynamic, persisted to localStorage, constrained 280-600px</done>
</task>

<task type="auto">
  <name>Task 3: Polish resize interaction</name>
  <files>src/renderer/src/components/Layout/ResizeHandle.tsx, src/renderer/src/assets/main.css</files>
  <action>
Improve resize UX:

**ResizeHandle enhancements:**
- Add visual feedback during drag (add class to document.body)
- Set cursor on body during drag (prevents cursor flicker)
- Prevent text selection during drag (user-select: none on body)

**CSS in main.css:**
```css
body.resizing {
  cursor: col-resize !important;
  user-select: none !important;
}
body.resizing * {
  cursor: col-resize !important;
}
```

**ResizeHandle updates:**
- On mousedown: `document.body.classList.add('resizing')`
- On mouseup: `document.body.classList.remove('resizing')`
- Hover state: bg-gray-600/30 â†’ bg-blue-500/50 on hover
  </action>
  <verify>Drag interaction is smooth, cursor doesn't flicker, text is not selected</verify>
  <done>Resize interaction is polished with proper cursor and selection handling</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Drag left edge of chat panel resizes it
- [ ] Width stays between 280-600px
- [ ] Width persists after page reload
- [ ] Cursor shows resize affordance on handle hover
- [ ] No text selection or cursor flicker during drag
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Chat panel is resizable with smooth drag interaction
- Width preference persists across sessions
</success_criteria>

<output>
After completion, create `.planning/phases/27-resizable-chat/27-01-SUMMARY.md`
</output>
