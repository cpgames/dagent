---
phase: 22-pm-agent-crud-operations
plan: 01
type: execute
---

<objective>
Add UpdateTask and DeleteTask operations to PM Agent for full task management via Feature Chat.

Purpose: Enable users to modify and remove tasks through natural language conversation with the PM Agent.
Output: UpdateTask and DeleteTask tools integrated into PM Agent with IPC handlers and type definitions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-task-creation-from-chat/21-01-SUMMARY.md
@.planning/phases/21-task-creation-from-chat/21-02-SUMMARY.md

**Key files:**
@src/shared/types/pm-tools.ts
@src/main/ipc/pm-tools-handlers.ts
@src/main/agent/pm-tool-handlers.ts
@src/main/agent/tool-config.ts
@src/preload/index.ts
@src/preload/index.d.ts

**Tech stack available:** Electron IPC, Claude Agent SDK, Zustand stores
**Established patterns:**
- PM tool types in src/shared/types/pm-tools.ts
- IPC handlers in src/main/ipc/pm-tools-handlers.ts
- SDK tool definitions in src/main/agent/pm-tool-handlers.ts
- Handler registry pattern with setters
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add UpdateTask and DeleteTask types</name>
  <files>src/shared/types/pm-tools.ts</files>
  <action>
Add type definitions for UpdateTask and DeleteTask operations:

```typescript
export interface UpdateTaskInput {
  taskId: string
  title?: string         // New title (optional)
  description?: string   // New description (optional)
}

export interface UpdateTaskResult {
  success: boolean
  error?: string
}

export interface DeleteTaskInput {
  taskId: string
  reassignDependents?: 'cascade' | 'orphan' | 'reconnect'
  // cascade: Delete dependent tasks too
  // orphan: Leave dependent tasks with missing dependency
  // reconnect: Connect dependents to this task's dependencies (default)
}

export interface DeleteTaskResult {
  success: boolean
  deletedTaskIds?: string[]  // For cascade deletes
  error?: string
}
```

Follow existing pattern from CreateTaskInput/CreateTaskResult.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>UpdateTaskInput, UpdateTaskResult, DeleteTaskInput, DeleteTaskResult types exported</done>
</task>

<task type="auto">
  <name>Task 2: Add UpdateTask and DeleteTask IPC handlers</name>
  <files>src/main/ipc/pm-tools-handlers.ts</files>
  <action>
Add two new IPC handlers following the existing pattern:

**pm-tools:updateTask handler:**
- Validate taskId exists in DAG
- Update only provided fields (title, description)
- Save DAG after update
- Return success/error

**pm-tools:deleteTask handler:**
- Validate taskId exists in DAG
- Handle dependents based on `reassignDependents` option:
  - `cascade`: Collect all transitive dependents, delete all
  - `orphan`: Just remove connections, leave dependent tasks
  - `reconnect` (default): For each dependent, add connections to this task's dependencies
- Remove the task from nodes array
- Remove all connections involving this task
- Update dependent tasks' status if needed (blocked â†’ ready if no more deps)
- Save DAG
- Return success with deletedTaskIds for cascade

Important: For reconnect mode, if task A depends on B, and B depends on C, deleting B should make A depend on C.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>pm-tools:updateTask and pm-tools:deleteTask handlers registered</done>
</task>

<task type="auto">
  <name>Task 3: Add UpdateTask and DeleteTask to SDK tools and preload</name>
  <files>src/main/agent/pm-tool-handlers.ts, src/main/agent/tool-config.ts, src/preload/index.ts, src/preload/index.d.ts</files>
  <action>
**pm-tool-handlers.ts:**
1. Add handler registry entries:
   - updateTaskHandler, deleteTaskHandler with setters
2. Add to executePMTool switch
3. Add to isPMTool check
4. Add PM_TOOLS entries with schemas:
   - UpdateTask: taskId required, title/description optional
   - DeleteTask: taskId required, reassignDependents optional enum
5. Update getPMToolInstructions() with update/delete documentation

**tool-config.ts:**
- Add 'UpdateTask' and 'DeleteTask' to pmAgent preset array

**preload/index.ts:**
- Add updateTask and deleteTask methods to pmTools object

**preload/index.d.ts:**
- Add updateTask and deleteTask type declarations to PMToolsAPI
  </action>
  <verify>npm run typecheck passes</verify>
  <done>UpdateTask and DeleteTask available in pmAgent preset, exposed via preload</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run typecheck passes
- [ ] All 4 new types exported from @shared/types
- [ ] Both IPC handlers registered in pm-tools-handlers.ts
- [ ] Both tools in PM_TOOLS array with correct schemas
- [ ] pmAgent preset includes UpdateTask, DeleteTask
- [ ] preload exposes updateTask, deleteTask methods
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- UpdateTask modifies task title/description
- DeleteTask removes task with proper dependency handling
- Ready for Plan 22-02 (batch operations)
</success_criteria>

<output>
After completion, create `.planning/phases/22-pm-agent-crud-operations/22-01-SUMMARY.md`
</output>
