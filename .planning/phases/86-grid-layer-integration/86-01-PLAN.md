---
phase: 86-grid-layer-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/components/Background/layers/GridLayer.ts
  - src/renderer/src/components/Background/layers/index.ts
autonomous: true

must_haves:
  truths:
    - "Grid renders curved horizontal lines using quadratic bezier curves"
    - "Grid scrolls toward viewer with smooth delta-time animation"
    - "Grid uses cyan color (#00f0ff) for horizontal lines and magenta (#ff00ff) for vertical lines"
    - "Grid integrates with Layer interface for unified canvas system"
  artifacts:
    - path: "src/renderer/src/components/Background/layers/GridLayer.ts"
      provides: "Perspective grid layer with scrolling animation"
      min_lines: 80
      exports: ["GridLayer"]
    - path: "src/renderer/src/components/Background/layers/index.ts"
      provides: "Barrel export for all layers"
      contains: "GridLayer"
  key_links:
    - from: "src/renderer/src/components/Background/layers/GridLayer.ts"
      to: "Layer interface"
      via: "implements Layer"
      pattern: "implements Layer"
---

<objective>
Migrate SynthwaveGrid rendering logic into a GridLayer class that implements the Layer interface.

Purpose: Integrate the perspective grid into the unified canvas system, maintaining the same visual appearance while conforming to the composable layer architecture.

Output: GridLayer.ts implementing Layer interface with curved horizontal lines and converging vertical lines.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior layer implementations for pattern reference:
@src/renderer/src/components/Background/layers/types.ts
@src/renderer/src/components/Background/layers/HorizonGlowLayer.ts

# Source implementation to migrate:
@src/renderer/src/components/Background/SynthwaveGrid.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GridLayer class</name>
  <files>src/renderer/src/components/Background/layers/GridLayer.ts</files>
  <action>
Create GridLayer class implementing Layer interface. Extract rendering logic from SynthwaveGrid.tsx:

**Configuration constants:**
- `lineCount = 15` - Number of horizontal lines
- `verticalLineCount = 21` - Number of vertical lines (odd for center)
- `scrollSpeed = 0.05` - Scroll speed multiplier
- `horizonCyanColor = 'rgba(0, 240, 255, 0.8)'` - Horizontal line color
- `verticalMagentaColor = 'rgba(255, 0, 255, 0.6)'` - Vertical line color

**State:**
- `scrollOffset: number` - Current scroll position (wraps at baseSpacing)

**init():**
- Reset scrollOffset to 0
- Store context dimensions

**update(deltaTime):**
- Increment scrollOffset by `deltaTime * scrollSpeed`
- Wrap offset using modulo with baseSpacing

**render(ctx, context):**
1. Calculate horizonY at top (0), viewerY at bottom (height)
2. Calculate vanishing point at center top
3. Draw horizontal curved lines (cyan):
   - For each line 0 to lineCount+1:
   - Calculate y with perspective (t^1.5 exponential)
   - Calculate opacity fading toward horizon
   - Line width increases closer to viewer (1 to 2.5px)
   - Draw quadratic bezier: moveTo(0, y+curve), quadraticCurveTo(centerX, y-curve*0.5, width, y+curve)
4. Draw vertical lines (magenta):
   - For each line 0 to verticalLineCount-1:
   - Calculate bottom x position evenly spaced
   - Opacity based on distance from center
   - Draw from vanishing point to bottom

**reset():**
- Reset scrollOffset to 0

Reference SynthwaveGrid.tsx lines 41-103 for exact rendering algorithm.
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>GridLayer class exists with init/update/render/reset methods, implements Layer interface, renders curved horizontal lines and converging vertical lines</done>
</task>

<task type="auto">
  <name>Task 2: Export GridLayer from barrel</name>
  <files>src/renderer/src/components/Background/layers/index.ts</files>
  <action>
Add export for GridLayer to the layers barrel file.

Add after HorizonGlowLayer export:
```typescript
export { GridLayer } from './GridLayer';
```

Maintain alphabetical order of exports.
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>GridLayer exported from layers/index.ts</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] GridLayer.ts implements Layer interface correctly
- [ ] Horizontal lines use quadratic bezier curves
- [ ] Scroll animation uses delta time
- [ ] Cyan color for horizontal, magenta for vertical lines
- [ ] Export added to barrel file
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- GridLayer matches visual appearance of SynthwaveGrid
</success_criteria>

<output>
After completion, create `.planning/phases/86-grid-layer-integration/86-01-SUMMARY.md`
</output>
