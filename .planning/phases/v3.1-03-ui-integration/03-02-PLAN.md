---
phase: v3.1-03-ui-integration
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified: [src/renderer/src/views/DAGView.tsx, src/renderer/src/components/DAG/ExecutionControls.tsx]
autonomous: true

must_haves:
  truths:
    - "DAG view shows 'Analyze Tasks' button when needs_analysis tasks exist"
    - "Analysis progress is visible during analysis"
    - "Task execution is disabled while analysis is running"
  artifacts:
    - path: "src/renderer/src/views/DAGView.tsx"
      provides: "Analysis button and progress in DAG view"
      contains: "analysis:start"
    - path: "src/renderer/src/components/DAG/ExecutionControls.tsx"
      provides: "Analyze Tasks button"
      contains: "Analyze"
  key_links:
    - from: "src/renderer/src/components/DAG/ExecutionControls.tsx"
      to: "analysis:start IPC"
      via: "button onClick"
      pattern: "analysis:start"
---

<objective>
Add analysis controls to DAG View.

Purpose: Allow users to trigger and monitor task analysis from the DAG view
Output: "Analyze Tasks" button and analysis progress indicator in DAG view
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/v3.1-03-ui-integration/03-01-SUMMARY.md

@src/renderer/src/views/DAGView.tsx
@src/renderer/src/components/DAG/ExecutionControls.tsx
@src/main/ipc/analysis-handlers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add preload API for analysis operations</name>
  <files>src/preload/index.ts, src/preload/index.d.ts</files>
  <action>
    Expose analysis IPC in preload:
    1. Add `analysis` namespace to preload API
    2. Add `start(featureId: string)` - invoke 'analysis:start'
    3. Add `getStatus(featureId: string)` - invoke 'analysis:status'
    4. Add `getPending(featureId: string)` - invoke 'analysis:pending'
    5. Add `onEvent(callback)` - listen to 'analysis:event' channel
    6. Add `offEvent()` - remove listener
    7. Update type definitions
  </action>
  <verify>TypeScript compiles</verify>
  <done>Preload exposes analysis API</done>
</task>

<task type="auto">
  <name>Task 2: Add Analyze button to ExecutionControls</name>
  <files>src/renderer/src/components/DAG/ExecutionControls.tsx</files>
  <action>
    Add analysis button to execution controls:
    1. Add props: `pendingAnalysisCount?: number`, `isAnalyzing?: boolean`, `onAnalyze?: () => void`
    2. Add "Analyze Tasks" button (purple/violet color) when pendingAnalysisCount > 0
    3. Show spinner and "Analyzing..." when isAnalyzing
    4. Disable Start button when isAnalyzing (can't start dev work during analysis)
    5. Position button before Start button in control bar
  </action>
  <verify>Build passes</verify>
  <done>ExecutionControls shows Analyze button when needed</done>
</task>

<task type="auto">
  <name>Task 3: Wire analysis controls in DAGView</name>
  <files>src/renderer/src/views/DAGView.tsx</files>
  <action>
    Connect analysis controls:
    1. Add state: `isAnalyzing: boolean`, `pendingAnalysisCount: number`
    2. Add effect to fetch pending count on feature change via preload API
    3. Add IPC listener for 'analysis:event' to track progress
    4. Update pendingCount when 'kept'/'split' events arrive
    5. Set isAnalyzing=false on 'complete' event
    6. Add handleAnalyze callback that calls `window.electronAPI.analysis.start(featureId)`
    7. Pass props to ExecutionControls
  </action>
  <verify>Build passes, button appears when needs_analysis tasks exist</verify>
  <done>DAGView shows analysis controls and progress</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` passes
- [ ] "Analyze Tasks" button appears when needs_analysis tasks exist
- [ ] Button shows spinner during analysis
- [ ] Start button disabled during analysis
- [ ] Button disappears when no more needs_analysis tasks
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Analysis can be triggered from DAG view
- Progress visible during analysis
</success_criteria>

<output>
After completion, create `.planning/phases/v3.1-03-ui-integration/03-02-SUMMARY.md`
</output>
