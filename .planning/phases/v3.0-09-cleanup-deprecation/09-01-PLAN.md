---
phase: v3.0-09-cleanup-deprecation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/storage/feature-store.ts
  - src/preload/index.ts
  - src/preload/index.d.ts
  - src/renderer/src/stores/chat-store.ts
autonomous: true

must_haves:
  truths:
    - "Old chat methods are marked with @deprecated JSDoc tags"
    - "Console warnings appear when deprecated methods are called"
    - "Deprecation warnings point to SessionManager as replacement"
  artifacts:
    - path: "src/main/storage/feature-store.ts"
      provides: "Deprecated saveChat, loadChat methods"
      contains: "@deprecated"
    - path: "src/preload/index.ts"
      provides: "Deprecated chat preload functions"
      contains: "console.warn"
  key_links:
    - from: "deprecated methods"
      to: "SessionManager"
      via: "@deprecated JSDoc pointing to replacement"
      pattern: "@deprecated.*SessionManager"
---

<objective>
Mark old chat/session storage methods as deprecated with proper JSDoc tags and runtime warnings.

Purpose: Provide clear migration path for any code still using old chat storage methods.
Output: Deprecated methods with warnings pointing to SessionManager as replacement.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@doc/api-reference.md

@src/main/storage/feature-store.ts
@src/preload/index.ts
@src/preload/index.d.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deprecate FeatureStore chat methods</name>
  <files>src/main/storage/feature-store.ts</files>
  <action>
Add @deprecated JSDoc tags to the following methods in FeatureStore:
- saveChat(featureId, chat) - add: `@deprecated Use SessionManager.addMessage() instead. See doc/api-reference.md for migration guide.`
- loadChat(featureId) - add: `@deprecated Use SessionManager.getSession() instead. See doc/api-reference.md for migration guide.`
- saveNodeChat(featureId, nodeId, chat) - add: `@deprecated Use SessionManager with task context instead.`
- loadNodeChat(featureId, nodeId) - add: `@deprecated Use SessionManager with task context instead.`

Also add console.warn() at the start of each method body:
```typescript
console.warn('[DEPRECATED] FeatureStore.saveChat() is deprecated. Use SessionManager.addMessage() instead.');
```

Keep the method implementations intact for backward compatibility - just add the deprecation markers.
  </action>
  <verify>TypeScript compiles without errors: npx tsc --noEmit</verify>
  <done>All 4 chat methods have @deprecated JSDoc and console.warn deprecation warnings</done>
</task>

<task type="auto">
  <name>Task 2: Deprecate preload chat functions</name>
  <files>src/preload/index.ts, src/preload/index.d.ts</files>
  <action>
In src/preload/index.ts, find any direct chat loading/saving functions in the exposed API and add deprecation warnings.

Look for functions that call through to the old chat storage handlers (storage:saveChat, storage:loadChat, etc.) and:
1. Add console.warn at function start
2. Add @deprecated JSDoc in the index.d.ts type definitions

If there are no direct chat functions in preload (they may go through storage handlers instead), note this in the summary - the deprecation in FeatureStore is sufficient.
  </action>
  <verify>TypeScript compiles without errors: npx tsc --noEmit</verify>
  <done>Preload chat functions (if any) have deprecation warnings, or documented that chat goes through storage handlers</done>
</task>

<task type="auto">
  <name>Task 3: Add deprecation notice to chat-store</name>
  <files>src/renderer/src/stores/chat-store.ts</files>
  <action>
Add a file-level JSDoc comment at the top of chat-store.ts indicating the transition:

```typescript
/**
 * Chat store for legacy feature chat functionality.
 *
 * @deprecated This store uses the old chat storage format.
 * New code should use SessionManager for chat/session storage.
 * See doc/api-reference.md for the SessionManager API.
 *
 * Migration path:
 * - PM agent chats: Use SessionManager.getOrCreateSession(featureId, 'pm', ...)
 * - Task agent chats: Use SessionManager with task context
 */
```

Do NOT remove or modify the store's functionality - just add the deprecation notice.
  </action>
  <verify>TypeScript compiles without errors: npx tsc --noEmit</verify>
  <done>chat-store.ts has file-level deprecation notice with migration guidance</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npx tsc --noEmit passes
- [ ] npm run build succeeds
- [ ] Deprecated methods have @deprecated JSDoc tags
- [ ] Deprecated methods log console warnings
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Old chat methods clearly marked as deprecated
- Migration path documented in deprecation messages
</success_criteria>

<output>
After completion, create `.planning/phases/v3.0-09-cleanup-deprecation/09-01-SUMMARY.md`
</output>
