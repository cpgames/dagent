---
phase: v3.2-03-worktree-management
plan: 02
type: execute
wave: 2
depends_on: ["v3.2-03-01"]
files_modified:
  - src/renderer/src/components/Kanban/FeatureCard.tsx
  - src/renderer/src/components/Kanban/FeatureCard.css
  - src/renderer/src/views/KanbanView.tsx
autonomous: true

must_haves:
  truths:
    - "Feature cards show spinner during creating_worktree state"
    - "Progress messages are displayed during worktree creation"
    - "UI remains responsive during worktree creation"
    - "Status automatically updates when worktree completes"
  artifacts:
    - path: "src/renderer/src/components/Kanban/FeatureCard.tsx"
      provides: "Progress indicator for creating_worktree state"
      contains: "creating_worktree"
    - path: "src/renderer/src/views/KanbanView.tsx"
      provides: "Worktree progress subscription and state tracking"
      contains: "onWorktreeProgress"
  key_links:
    - from: "src/renderer/src/views/KanbanView.tsx"
      to: "window.electronAPI.feature.onWorktreeProgress"
      via: "IPC event subscription"
      pattern: "onWorktreeProgress"
---

<objective>
Add visual progress indicators for creating_worktree state and ensure UI updates when worktree creation completes.

Purpose: Users need visual feedback during the worktree creation process so they know the operation is in progress and can continue working on other tasks.

Output: FeatureCard shows spinner and progress messages during creating_worktree state, status updates automatically when complete.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/v3.2-03-worktree-management/v3.2-03-01-SUMMARY.md

@src/renderer/src/components/Kanban/FeatureCard.tsx
@src/renderer/src/components/Kanban/FeatureCard.css
@src/renderer/src/views/KanbanView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Track worktree progress messages in KanbanView</name>
  <files>src/renderer/src/views/KanbanView.tsx</files>
  <action>
    Add state and subscription to track worktree creation progress per feature.

    1. Add state for tracking worktree progress:
       ```typescript
       // Worktree creation progress per feature
       const [worktreeProgress, setWorktreeProgress] = useState<Record<string, string>>({});
       ```

    2. Subscribe to worktree progress events in useEffect (after the analysis event subscription around line 117):
       ```typescript
       // Subscribe to worktree progress events
       useEffect(() => {
         const unsubscribe = window.electronAPI.feature.onWorktreeProgress(
           (data: { featureId: string; message: string }) => {
             setWorktreeProgress(prev => ({
               ...prev,
               [data.featureId]: data.message
             }));
           }
         );
         return unsubscribe;
       }, []);
       ```

    3. Pass worktreeProgress to KanbanColumn (need to update KanbanColumn props as well).
       Add worktreeProgress prop to KanbanColumn render (around line 210).

    4. Update KanbanColumn to pass progress message to individual FeatureCards.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>KanbanView tracks worktree progress per feature and passes to columns</done>
</task>

<task type="auto">
  <name>Task 2: Display progress in FeatureCard for creating_worktree state</name>
  <files>src/renderer/src/components/Kanban/FeatureCard.tsx, src/renderer/src/components/Kanban/FeatureCard.css</files>
  <action>
    Update FeatureCard to show progress message during creating_worktree state.

    1. Add new prop for worktree progress:
       ```typescript
       interface FeatureCardProps {
         // ... existing props
         worktreeProgress?: string;  // Progress message during worktree creation
       }
       ```

    2. Update getStatusInfo function to use worktreeProgress when available:
       - For creating_worktree state, show worktreeProgress message if available
       - Otherwise show "Creating worktree..." as default

    3. The status info already handles creating_worktree state (line 207-209), just need to:
       - Use worktreeProgress prop if available instead of static "Creating worktree..." message

    Example update to getStatusInfo:
    ```typescript
    if (feature.status === 'creating_worktree') {
      return { message: worktreeProgress || 'Creating worktree...', showSpinner: true };
    }
    ```

    4. Ensure the spinner is visible and styled appropriately in CSS.
       The existing feature-card__status-spinner class should work.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>FeatureCard displays progress message during creating_worktree state</done>
</task>

<task type="auto">
  <name>Task 3: Update KanbanColumn to pass worktreeProgress to FeatureCard</name>
  <files>src/renderer/src/components/Kanban/KanbanColumn.tsx</files>
  <action>
    Update KanbanColumn to accept and pass worktreeProgress to FeatureCard.

    1. Add worktreeProgress to KanbanColumnProps interface:
       ```typescript
       interface KanbanColumnProps {
         // ... existing props
         worktreeProgress?: Record<string, string>;
       }
       ```

    2. Destructure worktreeProgress from props.

    3. Pass worktreeProgress to FeatureCard for each feature:
       ```typescript
       worktreeProgress={worktreeProgress?.[feature.id]}
       ```

    This connects the progress tracking from KanbanView through KanbanColumn to FeatureCard.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>KanbanColumn passes worktree progress to individual feature cards</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run typecheck passes
- [ ] npm run build succeeds
- [ ] Feature cards in creating_worktree state show spinner
- [ ] Progress messages appear during worktree creation
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Visual feedback visible during worktree creation
- Progress messages update in real-time
</success_criteria>

<output>
After completion, create `.planning/phases/v3.2-03-worktree-management/v3.2-03-02-SUMMARY.md`
</output>
