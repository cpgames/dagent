---
phase: v3.2-03-worktree-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/components/Kanban/FeatureCard.tsx
  - src/main/ipc/feature-handlers.ts
  - src/preload/index.ts
  - src/preload/index.d.ts
autonomous: true

must_haves:
  truths:
    - "User clicks Start button on not_started feature card"
    - "Feature status changes to creating_worktree immediately"
    - "Worktree creation happens in background (non-blocking)"
    - "Feature data is moved from pending to worktree location"
  artifacts:
    - path: "src/renderer/src/components/Kanban/FeatureCard.tsx"
      provides: "Start button for not_started features"
      contains: "handleStartFeature"
    - path: "src/main/ipc/feature-handlers.ts"
      provides: "IPC handler for startWorktreeCreation"
      contains: "feature:startWorktreeCreation"
  key_links:
    - from: "src/renderer/src/components/Kanban/FeatureCard.tsx"
      to: "window.electronAPI.feature.startWorktreeCreation"
      via: "IPC call on Start click"
      pattern: "startWorktreeCreation"
---

<objective>
Implement Start button on Kanban cards for not_started features that triggers background worktree creation.

Purpose: When user clicks Start on a Backlog feature, the worktree creation begins asynchronously while the feature status transitions to creating_worktree.

Output: FeatureCard shows Start button for not_started features, clicking triggers worktree creation via new IPC handler.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/v3.2-02-non-blocking-creation/v3.2-02-01-SUMMARY.md

@src/renderer/src/components/Kanban/FeatureCard.tsx
@src/main/ipc/feature-handlers.ts
@src/main/storage/feature-store.ts
@src/main/git/git-manager.ts
@src/preload/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Start button for not_started features in FeatureCard</name>
  <files>src/renderer/src/components/Kanban/FeatureCard.tsx</files>
  <action>
    Modify FeatureCard to show Start button for features with status 'not_started' (not just 'ready').

    Changes needed:
    1. Update `showStart` condition at line ~119 to include 'not_started':
       `const showStart = feature.status === 'ready' || feature.status === 'not_started';`

    2. Update handleStart function to handle not_started features differently:
       - For 'not_started' features: call `window.electronAPI.feature.startWorktreeCreation(feature.id)`
       - For 'ready' features: keep existing behavior (updateStatus to in_progress, then startExecution)

    3. Add loading state for worktree creation (use existing `isStarting` prop):
       - FeatureCard already has isStarting prop, so parent (KanbanColumn) can track this

    The Start button click should:
    - For not_started: Call startWorktreeCreation IPC â†’ transitions to creating_worktree
    - For ready: Keep existing updateStatus + startExecution flow
  </action>
  <verify>npm run typecheck passes</verify>
  <done>Start button appears on not_started feature cards and calls appropriate handler based on status</done>
</task>

<task type="auto">
  <name>Task 2: Create IPC handler for startWorktreeCreation</name>
  <files>src/main/ipc/feature-handlers.ts</files>
  <action>
    Add new IPC handler 'feature:startWorktreeCreation' that:

    1. Loads the feature from storage
    2. Validates feature is in 'not_started' status
    3. Updates feature status to 'creating_worktree' (use statusManager.updateFeatureStatus)
    4. Calls FeatureStore.moveFeatureToWorktree() to move data from pending to worktree location
    5. Calls GitManager.createFeatureWorktree() asynchronously (don't await - let it run in background)
    6. Returns immediately with { success: true, featureId }

    The worktree creation broadcasts progress via 'feature:worktree-progress' event (already exists in git-manager.ts).

    Add this handler after the existing 'feature:updateStatus' handler (around line 274).

    Important: The handler should NOT wait for worktree creation to complete. It should:
    - Update status synchronously
    - Move data synchronously (moveFeatureToWorktree)
    - Start worktree creation asynchronously (createFeatureWorktree with .then/.catch)
    - Return immediately

    When worktree creation completes (in the .then), update status to 'investigating'.
    When worktree creation fails (in .catch), update status back to 'not_started' and log error.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>IPC handler starts worktree creation in background and returns immediately</done>
</task>

<task type="auto">
  <name>Task 3: Expose startWorktreeCreation in preload</name>
  <files>src/preload/index.ts, src/preload/index.d.ts</files>
  <action>
    Add the startWorktreeCreation method to the feature API in preload:

    In src/preload/index.ts, add to the feature object (around line 593):
    ```typescript
    // Start worktree creation for a not_started feature
    startWorktreeCreation: (featureId: string): Promise<{ success: boolean; featureId?: string; error?: string }> =>
      ipcRenderer.invoke('feature:startWorktreeCreation', featureId),
    ```

    In src/preload/index.d.ts, add the type declaration in the feature interface.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>startWorktreeCreation is exposed to renderer and properly typed</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run typecheck passes
- [ ] npm run build succeeds
- [ ] Start button appears on not_started feature cards in Kanban
- [ ] Clicking Start on not_started feature triggers worktree creation
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Feature cards show Start for not_started status
- Worktree creation starts in background on Start click
</success_criteria>

<output>
After completion, create `.planning/phases/v3.2-03-worktree-management/v3.2-03-01-SUMMARY.md`
</output>
