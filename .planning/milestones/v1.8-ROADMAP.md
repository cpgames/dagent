# v1.8 DAG Execution

## Overview

Implement the core DAG execution engine where clicking Start runs the dependency-aware task execution. The PM (harness) agent assigns task agents to ready tasks, task agents communicate intentions back to PM for approval, and all communications are logged.

Based on DAGENT_SPEC.md sections 6 (Execution Engine) and 7 (Agent Communication).

## Phases

- [ ] **Phase 33: Execution Orchestration** - Wire Start button to execution loop, ready task identification
- [ ] **Phase 34: Agent Assignment** - PM assigns agents to ready tasks, task agent spawning
- [ ] **Phase 35: Intention-Approval Workflow** - Task agents propose intentions, PM approves/modifies/rejects
- [ ] **Phase 36: Communication Logging** - Log all agent communications to harness_log.json

## Phase Details

### Phase 33: Execution Orchestration
**Goal**: Connect Start button to actual execution loop
**Depends on**: v1.7 (Agent Logs)
**Research**: Unlikely (existing orchestrator patterns)
**Plans**: TBD

Scope:
- Wire ExecutionControls Start to orchestrator
- Implement ready task identification (dependencies met)
- Execution loop: while tasks remain, process ready tasks
- Task state transitions: blocked → ready → running → merging → completed
- Stop behavior: signal agents to halt gracefully

### Phase 34: Agent Assignment
**Goal**: PM assigns task agents to ready tasks
**Depends on**: Phase 33
**Research**: Unlikely (existing AgentService patterns)
**Plans**: TBD

Scope:
- PM agent identifies ready tasks from DAG
- Agent pool management (reserve 1 for PM, rest for tasks)
- Random assignment when more ready tasks than available agents
- Task status updates: ready → running when assigned
- Agent context assembly: task description, dependencies context, CLAUDE.md

### Phase 35: Intention-Approval Workflow
**Goal**: Task agents propose intentions, PM reviews and responds
**Depends on**: Phase 34
**Research**: Unlikely (DAGENT_SPEC section 7.2-7.4)
**Plans**: TBD

Scope:
- Task agent intention format: brief, batched, clear
- Task agent → PM: INTENTION message with proposed actions
- PM reviews against project context, other tasks
- PM → Task agent: APPROVED / APPROVED WITH NOTES / MODIFIED / REJECTED
- Task agent implements based on PM response
- Task agent → PM: ACTION message with completed work

### Phase 36: Communication Logging
**Goal**: All agent communications persisted to log
**Depends on**: Phase 35
**Research**: Unlikely (existing log types from v1.7)
**Plans**: TBD

Scope:
- Log intention messages from task agents
- Log approval/rejection responses from PM
- Log action completions from task agents
- Log errors and failures
- Update harness_log.json in real-time
- Logs viewable via existing LogDialog (task log button)

## Progress

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 33. Execution Orchestration | 0/TBD | Not started | - |
| 34. Agent Assignment | 0/TBD | Not started | - |
| 35. Intention-Approval Workflow | 0/TBD | Not started | - |
| 36. Communication Logging | 0/TBD | Not started | - |
