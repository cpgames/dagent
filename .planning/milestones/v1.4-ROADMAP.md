# Milestone v1.4: Agent System Overhaul

**Status:** SHIPPED 2026-01-14
**Phases:** 19-24
**Total Plans:** 11

## Overview

Major overhaul of the agent system to create a unified, configurable agent architecture. Centralizes chat UI, adds intelligent task management, introduces configurable agent roles, and provides comprehensive codebase context to all agents.

## Goals Achieved

1. **Unified Chat Interface** - Single ChatPanel component used across all agent interactions
2. **Intelligent Task Management** - PM Agent with full CRUD operations and dependency inference
3. **Configurable Agent Roles** - Visual Agents View with 5 configurable agent types
4. **Full Context Access** - All agents receive project/codebase context automatically
5. **Feature Lifecycle** - Complete feature management including deletion with cleanup

---

## Phases

### Phase 19: Centralized Chat Component

**Goal**: Refactor chat into a reusable component for all agent interactions
**Depends on**: v1.3 complete
**Plans**: 1/1 complete

Plans:
- [x] 19-01: Extract unified ChatPanel component with agent name header and clear button

**Key deliverables:**
- ChatPanel component with configurable agent name
- Clear button for message management
- Automatic context loading (no manual refresh)
- Context type support for feature/task/agent contexts

### Phase 20: Agents View

**Goal**: Create sidebar view for agent configuration and status
**Depends on**: Phase 19
**Plans**: 2/2 complete

Plans:
- [x] 20-01: Add Agents View tab in sidebar with agent cards
- [x] 20-02: Agent configuration UI (instructions, capabilities, model selection)

**Key deliverables:**
- Agents View tab in sidebar
- AgentConfig types with 5 configurable roles (PM, Harness, Developer, QA, Merge)
- Agent-store for managing configurations
- Status indicators and configuration panels

### Phase 21: Task Creation from Chat

**Goal**: Enable PM Agent to create tasks via Feature Chat
**Depends on**: Phase 20
**Plans**: 2/2 complete

Plans:
- [x] 21-01: Add task creation skill/tool for PM Agent
- [x] 21-02: Intelligent task placement with dependency inference

**Key deliverables:**
- PM Agent CreateTask and ListTasks tools
- IPC handlers for task management operations
- Dependency inference from existing tasks
- DAG auto-refresh after task creation

### Phase 22: PM Agent CRUD Operations

**Goal**: Full task management through PM Agent
**Depends on**: Phase 21
**Plans**: 2/2 complete

Plans:
- [x] 22-01: Task update and delete operations via chat
- [x] 22-02: Batch operations and task reorganization

**Key deliverables:**
- UpdateTask and DeleteTask tools
- AddDependency and RemoveDependency tools
- GetTask for detailed task information
- Enhanced PM Agent instructions for complete workflow

### Phase 23: Feature Deletion

**Goal**: Safe feature deletion with full cleanup
**Depends on**: Phase 22
**Plans**: 1/1 complete

Plans:
- [x] 23-01: Feature deletion with confirmation dialog and cleanup

**Key deliverables:**
- feature:delete IPC handler with comprehensive cleanup
- DeleteFeatureDialog with confirmation and branch deletion option
- Full cleanup: storage, worktrees, branches, running agents
- Delete button on FeatureCard with hover reveal

### Phase 24: Universal Context Access

**Goal**: All agents have full codebase and project context
**Depends on**: Phase 23
**Plans**: 2/2 complete

Plans:
- [x] 24-01: Context assembly service for project/codebase awareness
- [x] 24-02: Integrate context into all agent prompts

**Key deliverables:**
- ContextService with project structure discovery
- CLAUDE.md and PROJECT.md reading
- Git history retrieval
- Agent-specific prompt builders with role instructions
- autoContext option for automatic context injection

---

## Milestone Summary

**Key Decisions:**
- Singleton pattern for ContextService matching established patterns
- autoContext option overrides explicit systemPrompt when enabled
- PM tool instructions only included for PM agent type
- Graceful fallback to basic prompts if ContextService unavailable

**Issues Resolved:**
- Context assembly unified across all agent types
- Manual context refresh eliminated
- Feature cleanup comprehensive (agents, worktrees, branches, storage)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- Task type doesn't have filePaths field (returns empty array for now)

---

*For current project status, see .planning/ROADMAP.md*
