# Milestone v2.9: Create Feature Workflow

## Overview
Improve the feature creation workflow to make it more intuitive and efficient.

## Current State
- Features are created via "New Feature" button in header
- Simple dialog with just a name field
- No guidance or context provided
- No validation or suggestions

## Goals
- [x] Enhance feature creation dialog with additional fields
- [x] Improve feature creation UX

## User Requirements

### 1. Feature Description Field
- Add a description field to the "Create New Feature" dialog
- Allow users to provide context/details about the feature upfront
- Description should be optional but encouraged
- **Multi-line text area** for detailed descriptions

### 2. File Attachments
- Support attaching files to features during creation
- Supported file types: images (png, jpg, etc.), markdown (.md), CSV, and other relevant formats
- Files should be stored alongside feature data
- Use cases:
  - Mockups/wireframes (images)
  - Requirements documents (markdown)
  - Data samples (CSV)
  - Reference materials (PDFs, etc.)

### 3. Auto-Merge Checkbox
- Add an "Auto-merge" checkbox to the feature creation dialog
- When enabled, automatically triggers AI merge upon feature completion
- Streamlines the workflow by eliminating manual merge step
- Should be optional (unchecked by default or user preference)

### 4. Kanban Column Restructure and Feature Status Update
- **Remove** "Not Started" status/column (no longer needed in new workflow)
- Add new "Planning" status/column
- Add new "Backlog" status/column
- Add new "Archived" status/column (after Completed)
- **New complete column order**: Planning → Backlog → In Progress → Needs Attention → Completed → Archived
- **Column definitions**:
  - **Planning**: Features currently being planned by PM agent (first status after creation)
  - **Backlog**: Features with completed planning, ready to be prioritized/scheduled for development
  - **In Progress**: Features currently being developed
  - **Needs Attention**: Features blocked or requiring user intervention
  - **Completed**: Features finished and ready for merge
  - **Archived**: Features that have been merged (PR created/merged) - final state

### 5. Automatic Planning Phase Workflow
- When user clicks "Create" in new feature dialog, feature is placed in "Planning" status
- PM agent automatically spins up to plan the feature
- PM agent uses:
  - Feature name
  - Feature description
  - Attached files (images, docs, etc.)
- PM agent outputs:
  - Populates spec.md with feature specification
  - Creates initial task breakdown in DAG
- **When planning completes**: PM agent automatically moves feature to "Backlog" status
- Feature remains in Backlog until user manually moves it to start development

### 6. Centralized Feature Status Management
- Need a centralized method/API for updating feature status
- All status changes should go through this single method
- Ensures consistency across the application
- Should handle:
  - Status transitions (Planning → Backlog, Backlog → In Progress, etc.)
  - Status validation (prevent invalid transitions)
  - Event emission for UI updates
  - Persistence to storage
- Used by:
  - PM agent (when planning completes → Backlog)
  - User (manual status changes via Kanban drag-and-drop)
  - Orchestrator (when feature completion detected → Completed)
  - Auto-merge (when merge/PR completes → Archived)

### 7. Automatic Archive on Merge
- When a feature is merged (or PR is created for it), automatically move to "Archived" status
- Triggers:
  - Auto-merge completes successfully
  - Manual merge completes (PR created/merged)
- Uses centralized status management to transition Completed → Archived
- Archived features are the final state, indicating work is complete and integrated

### 8. Kanban Board Scrolling and UI Improvements
- **Horizontal scrolling**: Kanban board should be horizontally scrollable to accommodate all columns
- **Vertical scrolling per column**: Each individual column should be independently vertically scrollable
- **Custom scrollbar styling**: Update scrollbar styles throughout the entire app to match synthwave theme
  - Dark, semi-transparent scrollbar track
  - Purple/cyan accent for scrollbar thumb
  - Smooth hover effects
  - Apply to all scrollable areas (Kanban columns, DAG view, chat panel, etc.)

### 9. Feature Name Uniqueness Validation
- **Enforce unique feature names**: Feature names must be unique across all features in a project
- **Validation on creation**: Check for duplicate names when user submits the "Create New Feature" dialog
- **Inline validation error**: Show validation message under the name input field (similar to "Feature name is required")
  - Example: "A feature with this name already exists"
- **Prevent creation**: Do not create the feature if name already exists
- **Description is optional**: Empty descriptions are allowed
  - For simple features (e.g., "rename file x to y"), PM agent should be able to infer spec from name alone
  - PM agent can ask clarifying questions during planning if needed

### 10. Kanban Feature Card Action Updates
- **Remove "Archive" button**: No longer needed since archiving happens automatically on merge
- **Update merge icon**: Change to an icon that better resembles Git merge
  - Use a Git branch merge icon (fork with merging branches)
  - Should be visually distinct from other action icons

### 11. Context-Aware Start/Stop Buttons in Kanban
- **Start button**: Only appears on features in the "Backlog" column
  - When clicked, moves feature to "In Progress" and starts execution
- **Stop button**: Only appears on features in the "In Progress" column
  - When clicked, calls the same stop functionality as DAG view's Stop button
  - Stops execution/orchestrator for that feature
  - Updates feature status to "Backlog"
  - Moves feature card back to "Backlog" column
- **No Start/Stop buttons**: For features in Planning, Needs Attention, Completed, or Archived
- Uses centralized status management for all status transitions

---

## Proposed Phases

### Phase 93: Feature Status System Overhaul
**Goal**: Update feature status types and implement centralized status management

**Tasks**:
- Update `FeatureStatus` type in shared types to include new statuses (planning, backlog, archived)
- Remove `not_started` status from type definition
- Create centralized feature status management service/API
  - `updateFeatureStatus(featureId, newStatus)` method
  - Status transition validation logic
  - Event emission for UI updates
  - Persistence to storage
- Update all existing code that references feature statuses
- Add IPC handlers for status management
- Migration: Convert any existing `not_started` features to `planning` status

**Files**:
- `src/shared/types.ts`
- `src/main/services/feature-status-manager.ts` (new)
- `src/main/ipc/feature-handlers.ts`
- `src/renderer/src/stores/feature-store.ts`

---

### Phase 94: Enhanced Feature Creation Dialog
**Goal**: Add description, file attachments, auto-merge, and validation to feature creation

**Tasks**:
- Update `NewFeatureDialog` component:
  - Add multi-line description textarea
  - Add file attachment UI (drag-and-drop + file picker)
  - Add auto-merge checkbox
  - Add unique name validation with inline error display
- Update Feature type to include `description`, `attachments`, `autoMerge` fields
- Implement file storage system for feature attachments
  - Store in `.dagent/features/{featureId}/attachments/`
  - Add IPC handlers for file operations
- Update `createFeature` to accept new fields
- Handle feature creation with Planning status (instead of not_started)

**Files**:
- `src/renderer/src/components/Feature/NewFeatureDialog.tsx`
- `src/shared/types.ts`
- `src/main/storage/feature-storage.ts`
- `src/main/ipc/feature-handlers.ts`
- `src/renderer/src/stores/feature-store.ts`

---

### Phase 95: Kanban Column Restructure
**Goal**: Update Kanban board with new column structure and scrolling

**Tasks**:
- Update KanbanView to new column order: Planning → Backlog → In Progress → Needs Attention → Completed → Archived
- Remove "Not Started" column
- Implement horizontal scrolling for board
- Implement independent vertical scrolling per column
- Update drag-and-drop to use centralized status management
- Update column styling and layout

**Files**:
- `src/renderer/src/views/KanbanView.tsx`
- `src/renderer/src/views/KanbanView.css`

---

### Phase 96: Kanban Feature Card Updates
**Goal**: Update feature card actions and context-aware buttons

**Tasks**:
- Remove "Archive" button from feature cards
- Update merge button icon to Git branch merge icon
- Implement context-aware Start/Stop buttons:
  - Show Start button only in Backlog column
  - Show Stop button only in In Progress column
  - Start button: moves to In Progress and starts execution
  - Stop button: stops execution, moves back to Backlog
- Connect Stop button to orchestrator stop functionality
- Use centralized status management for transitions

**Files**:
- `src/renderer/src/components/Kanban/FeatureCard.tsx`
- `src/renderer/src/components/Kanban/FeatureCard.css`

---

### Phase 97: App-Wide Scrollbar Styling
**Goal**: Implement custom synthwave-themed scrollbars throughout the app

**Tasks**:
- Create global scrollbar CSS styles
- Apply to all scrollable areas:
  - Kanban columns
  - DAG view
  - Chat panel
  - Dialogs
  - All other scrollable containers
- Use dark semi-transparent track
- Use purple/cyan for scrollbar thumb
- Add smooth hover effects

**Files**:
- `src/renderer/src/styles/scrollbar.css` (new)
- `src/renderer/index.css` (import scrollbar styles)

---

### Phase 98: Automatic Planning Workflow
**Goal**: Implement PM agent auto-start on feature creation

**Tasks**:
- Update feature creation flow to trigger PM agent automatically
- PM agent receives feature name, description, and attachments
- PM agent creates spec.md and initial task breakdown
- PM agent uses centralized status management to move feature to Backlog when done
- Add progress indication in Planning column (show PM agent is working)
- Handle PM agent errors/failures gracefully

**Files**:
- `src/renderer/src/stores/feature-store.ts`
- `src/main/agents/pm-agent.ts`
- `src/main/ipc/pm-handlers.ts`
- `src/renderer/src/components/Kanban/FeatureCard.tsx` (progress indicator)

---

### Phase 99: Auto-Archive on Merge
**Goal**: Automatically archive features when merged

**Tasks**:
- Detect when merge/PR is completed:
  - Auto-merge completion
  - Manual merge completion (PR created/merged)
- Use centralized status management to transition Completed → Archived
- Update merge agent to trigger archive on success
- Update orchestrator to detect merge completion

**Files**:
- `src/main/agents/merge-agent.ts`
- `src/main/dag-engine/orchestrator.ts`
- `src/main/services/feature-status-manager.ts`

---

## Implementation Notes

**Recommended order**: Phases should be implemented in sequence (93 → 99) as each builds on the previous:
1. Phase 93 lays the foundation with centralized status management
2. Phase 94 adds the enhanced dialog with new fields
3. Phase 95-96 update Kanban UI to use new system
4. Phase 97 is independent UI polish
5. Phase 98 adds automatic planning workflow
6. Phase 99 adds automatic archiving

**Testing**: After each phase, verify:
- Status transitions work correctly
- UI updates reactively
- No regressions in existing functionality
- New features work as specified

---

## Notes
- Planning started: 2026-01-17
- Status: Gathering requirements
